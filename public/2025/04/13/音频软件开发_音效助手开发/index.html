<!DOCTYPE html>
<html lang="en">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="éŸ³æ•ˆåŠ©æ‰‹è½¯ä»¶å¼€å‘å½’æ¡£" />
    <meta name="hexo-theme-A4" content="v1.9.7" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>æ®µæºä¹</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery-bundle.min.css">


<meta name="generator" content="Hexo 7.3.0"></head>
    
    

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #e4e4e4 ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <style>
            .header-img {
                width: 56px;
                height: auto;
                object-fit: cover; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹ */
                transition: transform 0.3s ease-in-out; 
                border-radius: 50%; 
            }
            
        </style>
        <img 
            alt="^-^" 
            cache-control="max-age=86400" 
            class="header-img" 
            src="/img/favicon.webp" 
        />
        <div class="header-content">
            <a class="logo" href="/">æ®µæºä¹</a> 
            <span class="description">å£°éŸ³è®¾è®¡å¸ˆä¸¨éŸ³ä¹åˆ¶ä½œçˆ±å¥½è€…</span> 
        </div>
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/works/">ä½œå“</a></li>
            
        
            
                <li><a href="/about/">å…³äº</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    éŸ³æ•ˆåŠ©æ‰‹è½¯ä»¶å¼€å‘å½’æ¡£
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                    <span>æœ€è¿‘æ›´æ–°ï¼š2025-04-13</span> 
                
                
                    
                        &nbsp; | &nbsp;
                    
                     <span>å­—æ•°æ€»è®¡ï¼š7.8k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>é˜…è¯»ä¼°æ—¶ï¼š32åˆ†é’Ÿ</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span id="busuanzi_container_page_pv">
                        é˜…è¯»é‡ï¼š<span id="busuanzi_value_page_pv"></span>æ¬¡
                    </span>
                
            </div>
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%80%E3%80%81%E9%9F%B3%E9%A2%91%E5%8A%9F%E8%83%BD%E7%9A%84%E5%BC%80%E5%8F%91"><span class="post-toc-text">ä¸€ã€éŸ³é¢‘åŠŸèƒ½çš„å¼€å‘</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%A7%94%E6%89%98"><span class="post-toc-text">å§”æ‰˜</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="post-toc-text">ä½¿ç”¨æ­¥éª¤</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="post-toc-text">è§‚å¯Ÿè€…æ¨¡å¼</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%A7%94%E6%89%98%E7%B1%BB%E5%9E%8B-%E5%A7%94%E6%89%98%E4%BA%8B%E4%BB%B6"><span class="post-toc-text">å§”æ‰˜ç±»å‹&#x2F;å§”æ‰˜äº‹ä»¶</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%B8%A4%E7%A7%8D%E9%A2%84%E5%AE%9A%E7%9A%84%E4%BA%8B%E4%BB%B6%E6%B3%9B%E5%9E%8B"><span class="post-toc-text">ä¸¤ç§é¢„å®šçš„äº‹ä»¶æ³›å‹</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="post-toc-text">Lambdaè¡¨è¾¾å¼</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A"><span class="post-toc-text">äº‹ä»¶ç»‘å®š</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Hook"><span class="post-toc-text">Hook</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%9F%B3%E9%A2%91%E8%AE%BE%E5%A4%87%E8%AF%86%E5%88%AB%E4%B8%8E%E8%8E%B7%E5%8F%96%E5%92%8C%E5%88%87%E6%8D%A2"><span class="post-toc-text">éŸ³é¢‘è®¾å¤‡è¯†åˆ«ä¸è·å–å’Œåˆ‡æ¢</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#public-List-GetAudioDevices-%E6%96%B9%E6%B3%95"><span class="post-toc-text">public List GetAudioDevices()æ–¹æ³•</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#WaveOut-DeviceCount"><span class="post-toc-text">WaveOut.DeviceCount</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#WaveOut-GetCapabilities-i"><span class="post-toc-text">WaveOut.GetCapabilities(i)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="post-toc-text">å®ç°æ­¥éª¤</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E9%9F%B3%E9%A2%91%E8%AE%BE%E5%A4%87%E7%9A%84%E5%88%87%E6%8D%A2"><span class="post-toc-text">éŸ³é¢‘è®¾å¤‡çš„åˆ‡æ¢</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%9F%B3%E9%A2%91%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="post-toc-text">éŸ³é¢‘ç®¡ç†ç³»ç»Ÿ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E9%9F%B3%E9%A2%91%E6%96%87%E4%BB%B6%E6%92%AD%E6%94%BE%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="post-toc-text">éŸ³é¢‘æ–‡ä»¶æ’­æ”¾çš„å®ç°æ­¥éª¤</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#WaveStream"><span class="post-toc-text">WaveStream</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#InitializeButtons"><span class="post-toc-text">InitializeButtons()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E9%9F%B3%E9%A2%91%E6%92%AD%E6%94%BE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="post-toc-text">éŸ³é¢‘æ’­æ”¾ç®¡ç†ç³»ç»Ÿ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#1-%E9%9F%B3%E9%A2%91%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E5%92%8C%E6%98%A0%E5%B0%84"><span class="post-toc-text">1.éŸ³é¢‘æ–‡ä»¶åŠ è½½å’Œæ˜ å°„</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="post-toc-text">ç¤ºä¾‹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="post-toc-text">æ³¨æ„äº‹é¡¹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#2-%E9%9F%B3%E9%A2%91%E6%92%AD%E6%94%BE%E9%80%BB%E8%BE%91%E5%AE%9E%E7%8E%B0"><span class="post-toc-text">2.éŸ³é¢‘æ’­æ”¾é€»è¾‘å®ç°</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#WaveFileReader-%E4%B8%8E-AudioFileReader-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="post-toc-text">WaveFileReader ä¸ AudioFileReader çš„åŒºåˆ«</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="post-toc-text">ä½¿ç”¨åœºæ™¯</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-%E6%92%AD%E6%94%BE%E6%96%87%E4%BB%B6%E9%80%89%E6%8B%A9"><span class="post-toc-text">3.æ’­æ”¾æ–‡ä»¶é€‰æ‹©</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E9%9F%B3%E9%87%8F%E5%A4%A7%E5%B0%8F"><span class="post-toc-text">éŸ³é‡å¤§å°</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E8%BF%9B%E5%BA%A6%E6%9D%A1"><span class="post-toc-text">è¿›åº¦æ¡</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BA%8C%E3%80%81%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="post-toc-text">äºŒã€å¿«æ·é”®</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="post-toc-text">å®ç°</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#1-%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95"><span class="post-toc-text">1.å³é”®èœå•</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#2-%E5%BF%AB%E6%8D%B7%E9%94%AE%E8%AE%BE%E7%BD%AE%E7%AA%97%E5%8F%A3%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="post-toc-text">2.å¿«æ·é”®è®¾ç½®çª—å£çš„å®ç°</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-%E5%BF%AB%E6%8D%B7%E9%94%AE%E8%AE%BE%E7%BD%AE%E7%9A%84%E5%93%8D%E5%BA%94"><span class="post-toc-text">3.å¿«æ·é”®è®¾ç½®çš„å“åº”</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%85%A8%E5%B1%80%E5%93%8D%E5%BA%94"><span class="post-toc-text">å…¨å±€å“åº”</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%89%E3%80%81%E6%93%8D%E4%BD%9C%E5%AD%98%E5%82%A8"><span class="post-toc-text">ä¸‰ã€æ“ä½œå­˜å‚¨</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-ApplySettings-%E6%96%B9%E6%B3%95"><span class="post-toc-text">1. ApplySettings æ–¹æ³•</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Form1-FormClosing-%E6%96%B9%E6%B3%95"><span class="post-toc-text">2. Form1_FormClosing æ–¹æ³•</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-SaveButtonAudioPaths-%E6%96%B9%E6%B3%95"><span class="post-toc-text">3. SaveButtonAudioPaths æ–¹æ³•</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-ShowLoginForm-%E6%96%B9%E6%B3%95"><span class="post-toc-text">4. ShowLoginForm æ–¹æ³•</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%9B%9B%E3%80%81%E8%BD%AF%E4%BB%B6%E7%9A%84%E5%B0%81%E8%A3%85"><span class="post-toc-text">å››ã€è½¯ä»¶çš„å°è£…</span></a></li></ol>
            
        
        <div class=".article-gallery"><h2 id="ä¸€ã€éŸ³é¢‘åŠŸèƒ½çš„å¼€å‘"><a href="#ä¸€ã€éŸ³é¢‘åŠŸèƒ½çš„å¼€å‘" class="headerlink" title="ä¸€ã€éŸ³é¢‘åŠŸèƒ½çš„å¼€å‘"></a>ä¸€ã€éŸ³é¢‘åŠŸèƒ½çš„å¼€å‘</h2><p>æ ¸å¿ƒåŠŸèƒ½çš„å¼€å‘ï¼Œåˆ©ç”¨NAudio.dllç»„ä»¶è¿›è¡Œå¼€å‘ã€‚</p>
<h3 id="å§”æ‰˜"><a href="#å§”æ‰˜" class="headerlink" title="å§”æ‰˜"></a>å§”æ‰˜</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">delegate</span> <span class="built_in">double</span> <span class="title">Cal</span>(<span class="params"><span class="built_in">double</span> x,<span class="built_in">double</span> y</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Test</span>(<span class="params">Cal f</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.Write(<span class="string">&quot;è¯·è¾“å…¥X:&quot;</span>);</span><br><span class="line">    <span class="built_in">double</span> x=Convert.ToDouble(Console.ReadLine());</span><br><span class="line">    Console.write(<span class="string">&quot;è¯·è¾“å…¥Y:&quot;</span>);</span><br><span class="line">    <span class="built_in">double</span> y= Convert.ToDouble(Console. ReadLine());<span class="comment">//å§”æ‰˜æ–¹æ³•å·¥ä½œ,æ€ä¹ˆå·¥ä½œç”±å…·ä½“å§”æ‰˜å†³å®š</span></span><br><span class="line">    <span class="built_in">double</span> result =f(x, y);</span><br><span class="line">    Console.writeLine(<span class="string">&quot;x: &#123;0&#125;ä¸Y:&#123;1&#125;å§”æ‰˜æ–¹æ³•è®¡ç®—ç»“æœä¸º:&#123;2&#125;&quot;</span>ï¼Œx,y,result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	Test(<span class="keyword">new</span> Cal(Add));</span><br><span class="line">    Test(Add);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="built_in">double</span> <span class="title">Add</span>(<span class="params"><span class="built_in">double</span> x,<span class="built_in">double</span> y</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å°†ä¸å˜çš„è¿›è¡Œå°è£…ï¼Œå°†å˜çš„éš”ç¦»èµ·æ¥ï¼Œè®©ä»£ç æ›´æ˜“äºç»´æŠ¤ã€‚</p>
<blockquote>
<p><a href="/image/weituo" title="image-20241029134923881" class="gallery-item" style="box-shadow: none;"> <img src="/image/weituo" alt="image-20241029134923881"></a></p>
</blockquote>
<h4 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ä½¿ç”¨æ­¥éª¤"></a>ä½¿ç”¨æ­¥éª¤</h4><p>å®šä¹‰å§”æ‰˜</p>
<p>å®ä¾‹åŒ–å§”æ‰˜ï¼ˆèµ‹äºˆæ–¹æ³•ï¼‰</p>
<p>ä½¿ç”¨å§”æ‰˜ï¼ˆè¾“å…¥å‚æ•°ï¼‰</p>
<h4 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h4><p>ä¸€ç§äº‹ä»¶è§¦å‘çš„æ¨¡å¼ã€‚å½“å®šä¹‰æŸä¸ªå§”æ‰˜ä¹‹åï¼Œå…¶ä»–çš„ç±»çš„æ–¹æ³•å¯ä»¥è®¢é˜…è¿™ä¸ªå§”æ‰˜ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå§”æ‰˜ï¼Œæ¥ç»Ÿä¸€è§¦å‘ä¸€ç³»åˆ—äº‹ä»¶ã€‚</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyEvent?.Invoke(<span class="keyword">this</span>, e); <span class="comment">// æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•è®¢é˜…è€…ï¼Œç„¶åè§¦å‘äº‹ä»¶</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p><a href="/image/weituo2" title="image-20241029141958516" class="gallery-item" style="box-shadow: none;"> <img src="/image/weituo2" alt="image-20241029141958516"></a></p>
<p><a href="/image/weituo3" title="image-20241029142154108" class="gallery-item" style="box-shadow: none;"> <img src="/image/weituo3" alt="image-20241029142154108"></a></p>
</blockquote>
<h4 id="å§”æ‰˜ç±»å‹-å§”æ‰˜äº‹ä»¶"><a href="#å§”æ‰˜ç±»å‹-å§”æ‰˜äº‹ä»¶" class="headerlink" title="å§”æ‰˜ç±»å‹&#x2F;å§”æ‰˜äº‹ä»¶"></a>å§”æ‰˜ç±»å‹&#x2F;å§”æ‰˜äº‹ä»¶</h4><p>å®šä¹‰ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> OnGameOver onGameOver;</span><br></pre></td></tr></table></figure>

<p>äº‹ä»¶å§”æ‰˜å’Œå¸¸è§„å§”æ‰˜ç›¸åŒï¼Œåªæ˜¯äº‹ä»¶å§”æ‰˜åªèƒ½ä»è‡ªå·±çš„ç±»ä¸­è¿›è¡Œè°ƒç”¨ï¼Œå…¶ä»–è„šæœ¬åªèƒ½è¿›è¡Œè®¢é˜…æˆ–è€…å–æ¶ˆï¼Œä½†æ˜¯ä¸èƒ½è§¦å‘ã€æ›´æ”¹ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢å…¶ä»–è„šæœ¬æ‰§è¡Œç›¸å…³æ“ä½œã€‚</p>
<h4 id="ä¸¤ç§é¢„å®šçš„äº‹ä»¶æ³›å‹"><a href="#ä¸¤ç§é¢„å®šçš„äº‹ä»¶æ³›å‹" class="headerlink" title="ä¸¤ç§é¢„å®šçš„äº‹ä»¶æ³›å‹"></a>ä¸¤ç§é¢„å®šçš„äº‹ä»¶æ³›å‹</h4><p>æ— è¿”å›å€¼ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Action&lt;T1,T2,T3&gt;</span><br></pre></td></tr></table></figure>

<p>æœ‰è¿”å›å€¼ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Func&lt;T1,T2,T3&gt;</span><br></pre></td></tr></table></figure>



<h4 id="Lambdaè¡¨è¾¾å¼"><a href="#Lambdaè¡¨è¾¾å¼" class="headerlink" title="Lambdaè¡¨è¾¾å¼"></a>Lambdaè¡¨è¾¾å¼</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">() =&gt;&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>lambdaè¡¨è¾¾å¼è¦å’Œå§”æ‰˜ï¼Œäº‹ä»¶è”åˆä½¿ç”¨ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Func&lt;<span class="built_in">int</span> , <span class="built_in">int</span>&gt; func = x =&gt; x+<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">Func&lt;<span class="built_in">int</span> , <span class="built_in">int</span>&gt; func;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">fx</span>(<span class="params"><span class="built_in">int</span> x</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å†ä¾‹å¦‚ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Action&lt;<span class="built_in">string</span>&gt; action =msg =&gt;Console.WriteLine(msg);</span><br><span class="line"></span><br><span class="line">Action&lt;<span class="built_in">string</span>&gt; action <span class="built_in">string</span> msg =&gt;Console.WriteLine(msg);</span><br></pre></td></tr></table></figure>

<h4 id="äº‹ä»¶ç»‘å®š"><a href="#äº‹ä»¶ç»‘å®š" class="headerlink" title="äº‹ä»¶ç»‘å®š"></a>äº‹ä»¶ç»‘å®š</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">button.Click += (s, e) =&gt; Button_Click(button);</span><br></pre></td></tr></table></figure>

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">event</span> EventHandler Click&#123;<span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//delegate void System.EventHandler(object sender, System.EventArgs e)è¡¨ç¤ºå°†ç”¨äºå¤„ç†ä¸å…·æœ‰äº‹ä»¶æ•°æ®çš„äº‹ä»¶çš„æ–¹æ³•ã€‚</span></span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹ä¸¤ç§è¡¨è¿°éƒ½æ˜¯é”™è¯¯çš„ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">button.Click += Button_Click;</span><br></pre></td></tr></table></figure>

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">button.Click += Button_Click(Button button);</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºï¼š</p>
<p><code>Button_Click</code> æ–¹æ³•çš„ç­¾åä¸ <code>EventHandler</code> å§”æ‰˜ä¸åŒ¹é…ï¼Œä½¿ç”¨ <code>button.Click += Button_Click;</code> å°†ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚</p>
<p><code>EventHandler</code> çš„ç­¾åæ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">csharp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¤åˆ¶ä»£ç </span><br><span class="line">void EventHandler(object sender, EventArgs e);</span><br></pre></td></tr></table></figure>

<p>å‡è®¾ <code>Button_Click</code> æ–¹æ³•çš„ç­¾åæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">csharpå¤åˆ¶ä»£ç private void Button_Click(Button button)</span><br><span class="line">&#123;</span><br><span class="line">    // å¤„ç†é€»è¾‘</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>Button_Click</code> çš„ç­¾åä¸åŒ¹é… <code>EventHandler</code> å§”æ‰˜ï¼Œå› æ­¤æ‚¨ä¸èƒ½ç›´æ¥ä½¿ç”¨æ–¹æ³•ç»„æ¥è®¢é˜…äº‹ä»¶ã€‚ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ƒæ‰¾ä¸åˆ°ä¸ <code>EventHandler</code> å§”æ‰˜åŒ¹é…çš„é‡è½½ã€‚</p>
<h3 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h3><p>ç•¥â€¦</p>
<h3 id="éŸ³é¢‘è®¾å¤‡è¯†åˆ«ä¸è·å–å’Œåˆ‡æ¢"><a href="#éŸ³é¢‘è®¾å¤‡è¯†åˆ«ä¸è·å–å’Œåˆ‡æ¢" class="headerlink" title="éŸ³é¢‘è®¾å¤‡è¯†åˆ«ä¸è·å–å’Œåˆ‡æ¢"></a>éŸ³é¢‘è®¾å¤‡è¯†åˆ«ä¸è·å–å’Œåˆ‡æ¢</h3><p>é€šè¿‡ç±»AudioDeviceManageræ¥å®ç°éŸ³é¢‘è®¾å¤‡çš„è¯†åˆ«ã€‚</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> NAudio.Wave;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AudioDeviceManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;WaveOutCapabilities&gt; <span class="title">GetAudioDevices</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        List&lt;WaveOutCapabilities&gt; devices = <span class="keyword">new</span> List&lt;WaveOutCapabilities&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; WaveOut.DeviceCount; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            devices.Add(WaveOut.GetCapabilities(i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> devices;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="public-List-GetAudioDevices-æ–¹æ³•"><a href="#public-List-GetAudioDevices-æ–¹æ³•" class="headerlink" title="public List GetAudioDevices()æ–¹æ³•"></a>public List<WaveOutCapabilities> GetAudioDevices()æ–¹æ³•</h4><p>é€šå¸¸ç”¨äºè·å–ç³»ç»Ÿä¸­å¯ç”¨çš„éŸ³é¢‘è®¾å¤‡åˆ—è¡¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å« <code>WaveOutCapabilities</code> å¯¹è±¡çš„åˆ—è¡¨ã€‚æ¯ä¸ª <code>WaveOutCapabilities</code> å¯¹è±¡æè¿°äº†ä¸€ä¸ªéŸ³é¢‘è¾“å‡ºè®¾å¤‡çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>è®¾å¤‡åç§°</li>
<li>æ”¯æŒçš„å£°é“æ•°</li>
<li>é‡‡æ ·ç‡</li>
<li>æ”¯æŒçš„ä½æ·±åº¦</li>
</ul>
<h4 id="WaveOut-DeviceCount"><a href="#WaveOut-DeviceCount" class="headerlink" title="WaveOut.DeviceCount"></a><code>WaveOut.DeviceCount</code></h4><p>æ˜¯ä¸€ä¸ªé™æ€å±æ€§ï¼Œç”¨äºè·å–ç³»ç»Ÿä¸­å¯ç”¨çš„éŸ³é¢‘è¾“å‡ºè®¾å¤‡çš„æ•°é‡ã€‚è¿™ä¸ªå±æ€§è¿”å›ä¸€ä¸ª<strong>æ•´æ•°</strong>ï¼Œè¡¨ç¤ºå½“å‰å¯ä»¥ç”¨äºéŸ³é¢‘æ’­æ”¾çš„è®¾å¤‡æ€»æ•°ã€‚å¯ä»¥ç”¨å®ƒæ¥éå†æ¯ä¸ªè®¾å¤‡ï¼Œè¿›è€Œè·å–è®¾å¤‡çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<h4 id="WaveOut-GetCapabilities-i"><a href="#WaveOut-GetCapabilities-i" class="headerlink" title="WaveOut.GetCapabilities(i)"></a>WaveOut.GetCapabilities(i)</h4><p>æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºè·å–æŒ‡å®šç´¢å¼• <code>i</code> çš„éŸ³é¢‘è¾“å‡ºè®¾å¤‡çš„èƒ½åŠ›ï¼ˆ<code>WaveOutCapabilities</code>ï¼‰ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª <code>WaveOutCapabilities</code> å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³è®¾å¤‡çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><strong>è®¾å¤‡åç§°</strong>ï¼šéŸ³é¢‘è®¾å¤‡çš„æè¿°æ€§åç§°ã€‚</li>
<li><strong>æ”¯æŒçš„å£°é“æ•°</strong>ï¼šè®¾å¤‡æ”¯æŒçš„å£°é“ï¼ˆå•å£°é“æˆ–ç«‹ä½“å£°ï¼‰æ•°é‡ã€‚</li>
<li><strong>æœ€å¤§é‡‡æ ·ç‡</strong>ï¼šè®¾å¤‡æ”¯æŒçš„æœ€é«˜é‡‡æ ·ç‡ã€‚</li>
<li><strong>æœ€å¤§ä½æ·±åº¦</strong>ï¼šè®¾å¤‡æ”¯æŒçš„æœ€é«˜ä½æ·±åº¦ï¼ˆå¦‚16ä½ã€24ä½ç­‰ï¼‰ã€‚</li>
</ul>
<h4 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LoadAudioDevices</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> devices = audioDeviceManager.GetAudioDevices();</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> device <span class="keyword">in</span> devices)</span><br><span class="line">    &#123;</span><br><span class="line">        comboBoxDevices.Items.Add(device.ProductName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (comboBoxDevices.Items.Count &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        comboBoxDevices.SelectedIndex = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LoadAudioDevices</code> æ–¹æ³•çš„åŠŸèƒ½æ˜¯åŠ è½½ç³»ç»Ÿä¸­çš„éŸ³é¢‘è®¾å¤‡å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°ä¸‹æ‹‰æ¡†ï¼ˆ<code>comboBoxDevices</code>ï¼‰ä¸­ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>è·å–éŸ³é¢‘è®¾å¤‡åˆ—è¡¨</strong>ï¼šè°ƒç”¨ <code>audioDeviceManager.GetAudioDevices()</code> æ–¹æ³•ï¼Œè·å–å¯ç”¨çš„éŸ³é¢‘è®¾å¤‡åˆ—è¡¨ã€‚</li>
<li><strong>æ·»åŠ è®¾å¤‡åˆ°ä¸‹æ‹‰æ¡†</strong>ï¼šä½¿ç”¨ <code>foreach</code> å¾ªç¯éå†è®¾å¤‡åˆ—è¡¨ï¼Œå°†æ¯ä¸ªè®¾å¤‡çš„åç§°ï¼ˆ<code>device.ProductName</code>ï¼‰æ·»åŠ åˆ° <code>comboBoxDevices.Items</code> ä¸­ã€‚</li>
<li><strong>é€‰æ‹©ç¬¬ä¸€ä¸ªè®¾å¤‡</strong>ï¼šå¦‚æœä¸‹æ‹‰æ¡†ä¸­æœ‰è®¾å¤‡é¡¹ï¼ˆ<code>Items.Count</code> å¤§äº 0ï¼‰ï¼Œå°† <code>comboBoxDevices.SelectedIndex</code> è®¾ç½®ä¸º 0ï¼Œé»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªè®¾å¤‡ã€‚</li>
<li>æ³¨æ„äº‹é¡¹ï¼š<ul>
<li>ç¡®ä¿ <code>audioDeviceManager</code> å·²æ­£ç¡®åˆå§‹åŒ–ã€‚</li>
<li>å¦‚æœéœ€è¦å¤„ç†æ²¡æœ‰å¯ç”¨è®¾å¤‡çš„æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘åœ¨ä¸‹æ‹‰æ¡†ä¸­æ˜¾ç¤ºä¸€æ¡æç¤ºä¿¡æ¯ã€‚</li>
</ul>
</li>
</ol>
<h4 id="éŸ³é¢‘è®¾å¤‡çš„åˆ‡æ¢"><a href="#éŸ³é¢‘è®¾å¤‡çš„åˆ‡æ¢" class="headerlink" title="éŸ³é¢‘è®¾å¤‡çš„åˆ‡æ¢"></a>éŸ³é¢‘è®¾å¤‡çš„åˆ‡æ¢</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">comboBoxDevices_SelectedIndexChanged</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (waveOut != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        waveOut.Stop();</span><br><span class="line">        waveOut.Dispose();</span><br><span class="line">        waveOut = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (audioFileReader != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        audioFileReader.Dispose();</span><br><span class="line">        audioFileReader = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(currentFilePath))</span><br><span class="line">    &#123;</span><br><span class="line">        waveOut = <span class="keyword">new</span> WaveOutEvent</span><br><span class="line">        &#123;</span><br><span class="line">            DeviceNumber = comboBoxDevices.SelectedIndex,</span><br><span class="line">            Volume = volumeSlider.Volume</span><br><span class="line">        &#125;;</span><br><span class="line">        audioFileReader = <span class="keyword">new</span> AudioFileReader(currentFilePath);</span><br><span class="line">        waveOut.Init(audioFileReader);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isPlaying)</span><br><span class="line">        &#123;</span><br><span class="line">            waveOut.Play();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª <code>comboBoxDevices_SelectedIndexChanged</code> æ–¹æ³•çš„åŠŸèƒ½æ˜¯å¤„ç†ç”¨æˆ·åœ¨è®¾å¤‡é€‰æ‹©ä¸‹æ‹‰æ¡†ï¼ˆ<code>comboBoxDevices</code>ï¼‰ä¸­æ›´æ”¹é€‰å®šè®¾å¤‡æ—¶çš„é€»è¾‘ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>**åœæ­¢å¹¶é‡Šæ”¾ç°æœ‰çš„ <code>waveOut</code>**ï¼šå¦‚æœ <code>waveOut</code> ä¸ä¸ºç©ºï¼Œå…ˆåœæ­¢æ’­æ”¾å¹¶é‡Šæ”¾å…¶èµ„æºã€‚</li>
<li><strong>é‡Šæ”¾éŸ³é¢‘æ–‡ä»¶è¯»å–å™¨</strong>ï¼šå¦‚æœ <code>audioFileReader</code> ä¸ä¸ºç©ºï¼Œé‡Šæ”¾å…¶èµ„æºã€‚</li>
<li><strong>æ£€æŸ¥å½“å‰æ–‡ä»¶è·¯å¾„</strong>ï¼šå¦‚æœ <code>currentFilePath</code> ä¸ä¸ºç©ºï¼Œåˆ™è¿›è¡Œä¸‹ä¸€æ­¥ï¼š</li>
<li><strong>åˆ›å»ºæ–°çš„ <code>WaveOutEvent</code> å®ä¾‹</strong>ï¼š<ul>
<li>è®¾ç½® <code>DeviceNumber</code> ä¸ºæ‰€é€‰è®¾å¤‡çš„ç´¢å¼•ã€‚</li>
<li>å°†éŸ³é‡è®¾ç½®ä¸ºæ»‘å—ï¼ˆ<code>volumeSlider.Volume</code>ï¼‰çš„å€¼ã€‚</li>
</ul>
</li>
<li>**åˆå§‹åŒ– <code>AudioFileReader</code>**ï¼šä½¿ç”¨å½“å‰æ–‡ä»¶è·¯å¾„åˆ›å»ºæ–°çš„ <code>AudioFileReader</code> å®ä¾‹ï¼Œå¹¶ç”¨å…¶åˆå§‹åŒ– <code>waveOut</code>ã€‚</li>
<li><strong>æ’­æ”¾éŸ³é¢‘</strong>ï¼šå¦‚æœå½“å‰çŠ¶æ€ä¸ºæ’­æ”¾ï¼ˆ<code>isPlaying</code> ä¸ºçœŸï¼‰ï¼Œåˆ™è°ƒç”¨ <code>waveOut.Play()</code> å¼€å§‹æ’­æ”¾ã€‚</li>
</ol>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>ç¡®ä¿åœ¨é€‰æ‹©æ–°è®¾å¤‡æ—¶ï¼Œæ­£ç¡®ç®¡ç†èµ„æºï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚</li>
<li>å¦‚æœ <code>currentFilePath</code> å¯èƒ½ä¸ºç©ºï¼Œè€ƒè™‘åœ¨æ­¤å¤„æ·»åŠ é”™è¯¯å¤„ç†é€»è¾‘ã€‚</li>
</ul>
<h3 id="éŸ³é¢‘ç®¡ç†ç³»ç»Ÿ"><a href="#éŸ³é¢‘ç®¡ç†ç³»ç»Ÿ" class="headerlink" title="éŸ³é¢‘ç®¡ç†ç³»ç»Ÿ"></a>éŸ³é¢‘ç®¡ç†ç³»ç»Ÿ</h3><h4 id="éŸ³é¢‘æ–‡ä»¶æ’­æ”¾çš„å®ç°æ­¥éª¤"><a href="#éŸ³é¢‘æ–‡ä»¶æ’­æ”¾çš„å®ç°æ­¥éª¤" class="headerlink" title="éŸ³é¢‘æ–‡ä»¶æ’­æ”¾çš„å®ç°æ­¥éª¤"></a>éŸ³é¢‘æ–‡ä»¶æ’­æ”¾çš„å®ç°æ­¥éª¤</h4><p><strong>åˆå§‹åŒ–</strong>ï¼šåœ¨æ„é€ å‡½æ•°æˆ–åˆå§‹åŒ–æ–¹æ³•ä¸­å®ä¾‹åŒ– <code>waveOut</code>ã€‚</p>
<p><strong>åŠ è½½éŸ³é¢‘æ•°æ®</strong>ï¼šå°†éŸ³é¢‘æ•°æ®åŠ è½½åˆ° <code>waveOut</code> ä¸­ã€‚é€šå¸¸ä½ ä¼šä½¿ç”¨ <code>AudioFileReader</code> æ¥è¯»å–éŸ³é¢‘æ–‡ä»¶ã€‚</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> audioFile = <span class="keyword">new</span> AudioFileReader(<span class="string">&quot;path/to/audio/file.mp3&quot;</span>);</span><br><span class="line">waveOut.Init(audioFile);</span><br></pre></td></tr></table></figure>

<p><strong>æ’­æ”¾éŸ³é¢‘ï¼›</strong></p>
<p><strong>æ§åˆ¶éŸ³é¢‘</strong>ï¼›</p>
<p><strong>é‡Šæ”¾èµ„æº</strong>ï¼šåœ¨ä¸å†éœ€è¦æ—¶ï¼Œç¡®ä¿è°ƒç”¨ <code>Dispose()</code> æ–¹æ³•é‡Šæ”¾ï¼ˆwaveoutå’Œaudiofileï¼‰èµ„æºã€‚</p>
<h4 id="WaveStream"><a href="#WaveStream" class="headerlink" title="WaveStream"></a><code>WaveStream</code></h4><p>æ˜¯ NAudio ä¸­çš„ä¸€ä¸ªåŸºç±»ï¼Œç”¨äºè¡¨ç¤ºéŸ³é¢‘æ•°æ®æµï¼Œå®ƒå¯ä»¥ç”¨äºå¤„ç†å„ç§éŸ³é¢‘æ ¼å¼ã€‚</p>
<p><code>WaveStream</code> çš„å¸¸è§ç”¨é€”ï¼š</p>
<ol>
<li><strong>åŠ è½½éŸ³é¢‘æ–‡ä»¶</strong>ï¼šå¯ä»¥é€šè¿‡ç»§æ‰¿ <code>WaveStream</code> çš„ç±»ï¼ˆå¦‚ <code>AudioFileReader</code>ï¼‰æ¥åŠ è½½éŸ³é¢‘æ–‡ä»¶ã€‚</li>
<li><strong>éŸ³é¢‘æ’­æ”¾</strong>ï¼š<code>WaveStream</code> å¯ä»¥ä¸ <code>WaveOut</code> æˆ– <code>WaveOutEvent</code> ç­‰è¾“å‡ºè®¾å¤‡é…åˆä½¿ç”¨ï¼Œä»¥å®ç°éŸ³é¢‘æ’­æ”¾ã€‚</li>
<li><strong>å¤„ç†æµæ•°æ®</strong>ï¼šå¯ä»¥ç”¨äºå¤„ç†å®æ—¶éŸ³é¢‘æµï¼Œæ¯”å¦‚å½•éŸ³æˆ–ç½‘ç»œéŸ³é¢‘æµã€‚</li>
</ol>
<h4 id="InitializeButtons"><a href="#InitializeButtons" class="headerlink" title="InitializeButtons()"></a>InitializeButtons()</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">InitializeButtons</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> button <span class="keyword">in</span> buttonAudioMapping.Keys)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (button != ButtonPlay)</span><br><span class="line">        &#123;</span><br><span class="line">            button.Click += (s, e) =&gt; Button_Click(button);</span><br><span class="line">            button.MouseUp += Button_MouseUp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç‚¹å‡»äº‹ä»¶</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">button.Click += (s, e) =&gt; Button_Click(button);</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™è¡Œä»£ç ä¸º <code>button</code> çš„ <code>Click</code> äº‹ä»¶æ·»åŠ äº†ä¸€ä¸ªåŒ¿åæ–¹æ³•ï¼ˆlambda è¡¨è¾¾å¼ï¼‰ã€‚å½“æŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œè¿™ä¸ªåŒ¿åæ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</li>
<li>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº† <code>Button_Click(button)</code>ï¼Œå°†å½“å‰æŒ‰é’®ä½œä¸ºå‚æ•°ä¼ é€’ã€‚è¿™æ ·ï¼Œä½ å¯ä»¥åœ¨ <code>Button_Click</code> æ–¹æ³•ä¸­å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œä½¿ç”¨ç‰¹å®šäºè¯¥æŒ‰é’®çš„é€»è¾‘ã€‚</li>
</ul>
<blockquote>
<p>Lambdaè¯­æ³•ï¼š</p>
<p>(å‚æ•°åˆ—è¡¨)&#x3D;&gt;</p>
<p>{</p>
<p>â€‹	&#x2F;&#x2F;å‡½æ•°ä½“</p>
<p>}</p>
<p>â€‹	&#x2F;&#x2F;â€œ&#x3D;&gt;â€æ„æ€ä¸ºgoes toã€‚</p>
</blockquote>
<h4 id="éŸ³é¢‘æ’­æ”¾ç®¡ç†ç³»ç»Ÿ"><a href="#éŸ³é¢‘æ’­æ”¾ç®¡ç†ç³»ç»Ÿ" class="headerlink" title="éŸ³é¢‘æ’­æ”¾ç®¡ç†ç³»ç»Ÿ"></a>éŸ³é¢‘æ’­æ”¾ç®¡ç†ç³»ç»Ÿ</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">byte</span>[] <span class="title">ReadStreamToByteArray</span>(<span class="params">UnmanagedMemoryStream stream</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> memoryStream = <span class="keyword">new</span> MemoryStream())</span><br><span class="line">    &#123;</span><br><span class="line">        stream.CopyTo(memoryStream);</span><br><span class="line">        <span class="keyword">return</span> memoryStream.ToArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">InitializeButtonAudioMapping</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    buttonAudioMapping = <span class="keyword">new</span> Dictionary&lt;Button, MemoryStream&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//ç¬‘å£°</span></span><br><span class="line">        &#123; ButtonPlayPause, <span class="keyword">new</span> MemoryStream(ReadStreamToByteArray(Properties.Resources.SFX_001)) &#125;,<span class="comment">// ç»§ç»­ä¸ºå…¶ä»–æŒ‰é’®è®¾ç½®éŸ³é¢‘æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">InitializeButtons</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> button <span class="keyword">in</span> buttonAudioMapping.Keys)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (button != ButtonPlay)</span><br><span class="line">        &#123;</span><br><span class="line">            button.Click += (s, e) =&gt; Button_Click(button);</span><br><span class="line">            button.MouseUp += Button_MouseUp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Button_Click</span>(<span class="params">Button button</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    HandleButtonClick(button);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">HandleButtonClick</span>(<span class="params">Button button</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!buttonAudioMapping.TryGetValue(button, <span class="keyword">out</span> MemoryStream audioStream))</span><br><span class="line">    &#123;</span><br><span class="line">        MessageBox.Show(<span class="string">&quot;éŸ³é¢‘æ–‡ä»¶æœªå®šä¹‰&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (waveStream == <span class="literal">null</span> || waveOut == <span class="literal">null</span> || isPlaying)</span><br><span class="line">    &#123;</span><br><span class="line">        StartPlayback(audioStream);</span><br><span class="line">        ButtonPlay.BackgroundImage = Properties.Resources.pause;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        StartPlayback(audioStream);</span><br><span class="line">        ButtonPlay.BackgroundImage = Properties.Resources.pause;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CleanUp</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (waveOut != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ç¡®ä¿äº‹ä»¶å¤„ç†ç¨‹åºè¢«è§£ç»‘</span></span><br><span class="line">        waveOut.PlaybackStopped -= OnPlaybackStopped;</span><br><span class="line">        waveOut.Stop();</span><br><span class="line">        waveOut.Dispose();</span><br><span class="line">        waveOut = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (audioFileReader != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        audioFileReader.Dispose();</span><br><span class="line">        audioFileReader = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ButtonPlay_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (waveOut == <span class="literal">null</span> || waveStream == <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (buttonAudioMapping.TryGetValue(ButtonPlay, <span class="keyword">out</span> MemoryStream audioStream))</span><br><span class="line">        &#123;</span><br><span class="line">            StartPlayback(audioStream);</span><br><span class="line">            ButtonPlay.BackgroundImage = Properties.Resources.pause;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (waveOut.PlaybackState == PlaybackState.Playing)</span><br><span class="line">        &#123;</span><br><span class="line">            waveOut.Pause();</span><br><span class="line">            isPlaying = <span class="literal">false</span>;</span><br><span class="line">            ButtonPlay.BackgroundImage = Properties.Resources.play;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            waveOut.Play();</span><br><span class="line">            isPlaying = <span class="literal">true</span>;</span><br><span class="line">            ButtonPlay.BackgroundImage = Properties.Resources.pause;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">StartPlayback</span>(<span class="params">MemoryStream audioStream</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    CleanUp();</span><br><span class="line"></span><br><span class="line">    waveOut = <span class="keyword">new</span> WaveOutEvent</span><br><span class="line">    &#123;</span><br><span class="line">        DeviceNumber = comboBoxDevices.SelectedIndex</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡ç½®æµä½ç½®</span></span><br><span class="line">    audioStream.Seek(<span class="number">0</span>, SeekOrigin.Begin);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ WaveFileReader</span></span><br><span class="line">    waveStream = <span class="keyword">new</span> WaveFileReader(audioStream);</span><br><span class="line">    waveOut.Init(waveStream);</span><br><span class="line">    waveOut.PlaybackStopped += OnPlaybackStopped;</span><br><span class="line"></span><br><span class="line">    waveOut.Play();</span><br><span class="line">    isPlaying = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¡®ä¿åˆå§‹åŒ–æ—¶æ›´æ–°è¿›åº¦æ¡</span></span><br><span class="line">    trackBarProgress.Maximum = (<span class="built_in">int</span>)waveStream.TotalTime.TotalSeconds;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ChangeAudioFile</span>(<span class="params">Button button</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®åªå…è®¸é€‰æ‹© .wav æ–‡ä»¶</span></span><br><span class="line">    openFileDialog.Filter = <span class="string">&quot;WAV files (*.wav)|*.wav&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (openFileDialog.ShowDialog() == DialogResult.OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> newFilePath = openFileDialog.FileName;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦ä¸º .wavï¼ˆå¦‚æœéœ€è¦è¿›ä¸€æ­¥éªŒè¯ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (System.IO.Path.GetExtension(newFilePath).ToLower() != <span class="string">&quot;.wav&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            MessageBox.Show(<span class="string">&quot;åªèƒ½é€‰æ‹© .wav æ ¼å¼çš„æ–‡ä»¶ï¼&quot;</span>, <span class="string">&quot;é”™è¯¯&quot;</span>, MessageBoxButtons.OK, MessageBoxIcon.Error);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        button.Text = System.IO.Path.GetFileNameWithoutExtension(newFilePath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ è½½éŸ³é¢‘æ–‡ä»¶ä¸º MemoryStream</span></span><br><span class="line">        <span class="built_in">byte</span>[] audioBytes = System.IO.File.ReadAllBytes(newFilePath);</span><br><span class="line">        System.IO.MemoryStream audioStream = <span class="keyword">new</span> System.IO.MemoryStream(audioBytes);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–° buttonAudioMapping å­—å…¸</span></span><br><span class="line">        <span class="keyword">if</span> (buttonAudioMapping.ContainsKey(button))</span><br><span class="line">        &#123;</span><br><span class="line">            buttonAudioMapping[button].Dispose(); <span class="comment">// é‡Šæ”¾æ—§çš„ MemoryStream</span></span><br><span class="line">            buttonAudioMapping[button] = audioStream;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            buttonAudioMapping.Add(button, audioStream);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–° appSettings ä¸­çš„éŸ³é¢‘æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">        appSettings.ButtonAudioFilePaths[button.Name] = newFilePath;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è‡ªåŠ¨ä¿å­˜è®¾ç½®</span></span><br><span class="line">        settingsManager.SaveSettings(appSettings);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnPlaybackStopped</span>(<span class="params"><span class="built_in">object</span> sender, StoppedEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    isPlaying = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ˜¯å¦æ­£åœ¨æ’­æ”¾å…¶ä»–éŸ³é¢‘</span></span><br><span class="line">    <span class="keyword">if</span> (waveOut == <span class="literal">null</span> || waveOut.PlaybackState != PlaybackState.Playing)</span><br><span class="line">    &#123;</span><br><span class="line">        ButtonPlay.BackgroundImage = Properties.Resources.play; <span class="comment">// æ’­æ”¾å›¾ç‰‡</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-éŸ³é¢‘æ–‡ä»¶åŠ è½½å’Œæ˜ å°„"><a href="#1-éŸ³é¢‘æ–‡ä»¶åŠ è½½å’Œæ˜ å°„" class="headerlink" title="1.éŸ³é¢‘æ–‡ä»¶åŠ è½½å’Œæ˜ å°„"></a>1.<strong>éŸ³é¢‘æ–‡ä»¶åŠ è½½å’Œæ˜ å°„</strong></h5><ul>
<li><code>ReadStreamToByteArray</code> æ–¹æ³•å°† <code>UnmanagedMemoryStream</code> è¯»å–åˆ°å­—èŠ‚æ•°ç»„ã€‚</li>
<li><code>InitializeButtonAudioMapping</code> æ–¹æ³•å°†éŸ³é¢‘æ–‡ä»¶ä¸æŒ‰é’®å…³è”ï¼Œä½¿ç”¨ <code>MemoryStream</code> å­˜å‚¨æ¯ä¸ªéŸ³é¢‘æ–‡ä»¶çš„å†…å®¹ã€‚</li>
<li>é‡‡ç”¨è¿™æ ·çš„æ–¹å¼å‚¨å­˜éŸ³é¢‘æ•°æ®åŸå› ï¼š</li>
</ul>
<p>â€‹	<strong>å†…å­˜ç®¡ç†</strong>ï¼šé€šè¿‡å°†éŸ³é¢‘æµè¯»å–åˆ° <code>MemoryStream</code> ä¸­ï¼Œå¯ä»¥æ›´çµæ´»åœ°ç®¡ç†å†…å­˜ã€‚<code>MemoryStream</code> å…è®¸åœ¨å†…å­˜ä¸­å¯¹éŸ³é¢‘æ•°æ®è¿›è¡Œå¿«é€Ÿè¯»å†™æ“ä½œï¼Œè€Œä¸éœ€è¦é¢‘ç¹åœ°è®¿é—®ç£ç›˜æ–‡ä»¶ã€‚</p>
<p>â€‹	<strong>æ˜“äºå¤„ç†</strong>ï¼šåœ¨æ’­æ”¾éŸ³é¢‘æ—¶ï¼Œå°†å…¶å­˜å‚¨åœ¨å†…å­˜ä¸­å¯ä»¥åŠ å¿«è®¿é—®é€Ÿåº¦ï¼Œå› ä¸ºå®ƒé¿å…äº†æ¯æ¬¡æ’­æ”¾æ—¶éƒ½å»è¯»å–æ–‡ä»¶ç³»ç»Ÿçš„å»¶è¿Ÿã€‚è¿™å¯¹äºç”¨æˆ·ä½“éªŒéå¸¸é‡è¦ã€‚</p>
<p>â€‹	<strong>æ•°æ®å°è£…</strong>ï¼šä½¿ç”¨ <code>ReadStreamToByteArray</code> æ–¹æ³•å°†éŸ³é¢‘æ–‡ä»¶çš„æµè½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ï¼Œä½¿å¾—éŸ³é¢‘æ–‡ä»¶å¯ä»¥ä»¥æ›´åŠ ç»Ÿä¸€çš„æ–¹å¼å­˜å‚¨å’Œä½¿ç”¨ã€‚è¿™ä½¿å¾—å°†å¤šä¸ªæŒ‰é’®ä¸ä¸åŒçš„éŸ³é¢‘æ–‡ä»¶å…³è”å˜å¾—ç®€å•ã€‚</p>
<p>â€‹	<strong>èµ„æºæ•´åˆ</strong>ï¼š<code>Properties.Resources</code> å¯ä»¥å°†èµ„æºåµŒå…¥åˆ°ç¨‹åºä¸­ï¼Œæ–¹ä¾¿ç®¡ç†å’Œè®¿é—®ã€‚å°†å…¶è½¬æ¢ä¸º <code>MemoryStream</code> ä½¿å¾—ä½ å¯ä»¥åœ¨è¿è¡Œæ—¶ç›´æ¥ä»åµŒå…¥çš„èµ„æºè¯»å–æ•°æ®ã€‚</p>
<p>â€‹	<strong>é¿å…ç¡¬ç¼–ç è·¯å¾„</strong>ï¼šç›´æ¥ä½¿ç”¨åµŒå…¥çš„èµ„æºè€Œä¸æ˜¯ä¾èµ–äºæ–‡ä»¶è·¯å¾„ï¼Œå‡å°‘äº†åœ¨æ–‡ä»¶ç®¡ç†ä¸Šçš„å¤æ‚æ€§ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†ç¨‹åºçš„å¯ç§»æ¤æ€§ã€‚</p>
<p><code>UnmanagedMemoryStream</code> æ˜¯ C# ä¸­çš„ä¸€ä¸ªç±»ï¼Œé€šå¸¸ç”¨äºå¤„ç†éæ‰˜ç®¡å†…å­˜ä¸­çš„æ•°æ®ã€‚ä¸å¸¸è§„çš„ <code>MemoryStream</code> ä¸åŒï¼Œ<code>UnmanagedMemoryStream</code> ä¸»è¦ç”¨äºè¯»å–å’Œå†™å…¥å­˜å‚¨åœ¨éæ‰˜ç®¡å†…å­˜ä¸­çš„å­—èŠ‚æ•°æ®ã€‚è¿™ç§ç±»å‹çš„æµé€‚åˆå¤„ç†é‚£äº›ä¸ç”± .NET åƒåœ¾å›æ”¶å™¨ç®¡ç†çš„å†…å­˜ï¼Œä¾‹å¦‚ï¼š</p>
<ol>
<li><strong>ä¸ P&#x2F;Invoke äº¤äº’</strong>ï¼šå½“ä½ éœ€è¦è°ƒç”¨æœ¬åœ° APIï¼ˆå¦‚ Windows APIï¼‰æ—¶ï¼Œé€šå¸¸éœ€è¦åœ¨éæ‰˜ç®¡å†…å­˜ä¸­æ“ä½œæ•°æ®ã€‚</li>
<li><strong>å¤„ç†å¤§æ•°æ®</strong>ï¼šåœ¨å¤„ç†å¤§æ–‡ä»¶æˆ–æ•°æ®å—æ—¶ï¼Œå¯ä»¥ä½¿ç”¨éæ‰˜ç®¡å†…å­˜æ¥æé«˜æ€§èƒ½ï¼Œå› ä¸ºå®ƒå¯ä»¥å‡å°‘å†…å­˜åˆ†é…çš„å¼€é”€ã€‚</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šç”±äºå®ƒç›´æ¥åœ¨éæ‰˜ç®¡å†…å­˜ä¸­æ“ä½œï¼Œå¯èƒ½ä¼šåœ¨æŸäº›æƒ…å†µä¸‹æä¾›æ›´å¥½çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸ç¡¬ä»¶æ¥å£æˆ–å…¶ä»–è¯­è¨€çš„ä»£ç äº¤äº’æ—¶ã€‚</li>
</ol>
<p><code>UnmanagedMemoryStream</code> é€šå¸¸ä¼šåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä½¿ç”¨ï¼š</p>
<ul>
<li>ä»æ“ä½œç³»ç»Ÿæˆ–å…¶ä»–ä½çº§ API ä¸­è·å–æ•°æ®ï¼Œå¹¶åœ¨ C# ä¸­å¤„ç†ã€‚</li>
<li>åœ¨ C# ä¸ C&#x2F;C++ ç­‰è¯­è¨€çš„äº’æ“ä½œä¸­ï¼Œç”¨äºä¼ é€’æŒ‡å‘éæ‰˜ç®¡å†…å­˜çš„æŒ‡é’ˆã€‚</li>
</ul>
<p>ä¾‹å­</p>
<p>ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯ï¼Œä½ å¯èƒ½ä¼šåœ¨è°ƒç”¨æŸä¸ªéæ‰˜ç®¡å‡½æ•°ä¹‹å‰ï¼Œå…ˆåœ¨éæ‰˜ç®¡å†…å­˜ä¸­åˆ†é…ç©ºé—´ï¼Œç„¶åä½¿ç”¨ <code>UnmanagedMemoryStream</code> æ¥è¯»å–æˆ–å†™å…¥æ•°æ®ã€‚</p>
<p>æ€»ä¹‹ï¼Œ<code>UnmanagedMemoryStream</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œé€‚ç”¨äºéœ€è¦ç›´æ¥æ“ä½œéæ‰˜ç®¡å†…å­˜çš„åœºæ™¯ã€‚</p>
<blockquote>
<p><strong>éæ‰˜ç®¡å†…å­˜</strong>æ˜¯æŒ‡ä¸ç”± .NET åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰ç®¡ç†çš„å†…å­˜ã€‚è¿™ç§å†…å­˜é€šå¸¸ç”±åº”ç”¨ç¨‹åºç›´æ¥åˆ†é…å’Œé‡Šæ”¾ï¼Œä¸»è¦ç”¨äºä¸åº•å±‚ç³»ç»Ÿæˆ–å…¶ä»–è¯­è¨€ï¼ˆå¦‚ C&#x2F;C++ï¼‰äº¤äº’ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³äºéæ‰˜ç®¡å†…å­˜çš„å…³é”®ç‚¹ï¼š</p>
<ol>
<li><strong>æ‰‹åŠ¨ç®¡ç†</strong>ï¼šåœ¨ä½¿ç”¨éæ‰˜ç®¡å†…å­˜æ—¶ï¼Œå¼€å‘è€…éœ€è¦æ‰‹åŠ¨åˆ†é…å’Œé‡Šæ”¾å†…å­˜ï¼Œä½¿ç”¨è¯¸å¦‚ <code>Marshal.AllocHGlobal</code> å’Œ <code>Marshal.FreeHGlobal</code> ç­‰æ–¹æ³•ã€‚</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šéæ‰˜ç®¡å†…å­˜å¯ä»¥ç”¨äºå¤„ç†æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚å¤§å‹æ•°æ®ç»“æ„æˆ–é«˜é¢‘ç‡çš„æ•°æ®äº¤äº’ï¼Œå› ä¸ºå®ƒå¯ä»¥å‡å°‘å†…å­˜åˆ†é…å’Œå›æ”¶çš„å¼€é”€ã€‚</li>
<li><strong>ä¸ç³»ç»Ÿ API äº¤äº’</strong>ï¼šè®¸å¤šç³»ç»Ÿçº§ API å’Œåº“ï¼ˆå°¤å…¶æ˜¯ C&#x2F;C++ ç¼–å†™çš„ï¼‰éœ€è¦ä½¿ç”¨éæ‰˜ç®¡å†…å­˜ï¼Œå› ä¸ºå®ƒä»¬ä¸ç†è§£ .NET çš„å†…å­˜ç®¡ç†æ¨¡å‹ã€‚</li>
<li><strong>æ•°æ®å…±äº«</strong>ï¼šéæ‰˜ç®¡å†…å­˜å¯ä»¥ç”¨äºåœ¨ä¸åŒè¯­è¨€æˆ–æ¨¡å—ä¹‹é—´å…±äº«æ•°æ®ï¼Œä¾‹å¦‚åœ¨ C# å’Œ C&#x2F;C++ ä»£ç ä¹‹é—´ä¼ é€’å¤æ‚æ•°æ®ç»“æ„ã€‚</li>
<li><strong>å¯èƒ½çš„å†…å­˜æ³„æ¼</strong>ï¼šç”±äºéœ€è¦æ‰‹åŠ¨ç®¡ç†ï¼Œå¼€å‘è€…å¿…é¡»å°å¿ƒä»¥é¿å…å†…å­˜æ³„æ¼æˆ–æœªå®šä¹‰è¡Œä¸ºï¼Œè¿™äº›éƒ½æ˜¯åœ¨éæ‰˜ç®¡å†…å­˜ä¸­æ¯”è¾ƒå¸¸è§çš„é—®é¢˜ã€‚</li>
</ol>
<p>åœ¨ä½¿ç”¨éæ‰˜ç®¡å†…å­˜æ—¶ï¼Œç¡®ä¿äº†è§£å…¶ç®¡ç†æ–¹å¼æ˜¯éå¸¸é‡è¦çš„ï¼Œä»¥ç¡®ä¿ç¨‹åºçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</p>
</blockquote>
<blockquote>
<p><strong><code>out</code> å…³é”®å­—</strong>ï¼š</p>
<ul>
<li>è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¾“å‡ºå‚æ•°ã€‚åœ¨æ–¹æ³•å†…éƒ¨ï¼Œå¿…é¡»å¯¹å…¶è¿›è¡Œèµ‹å€¼ã€‚</li>
<li>è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¸éœ€è¦åœ¨å¤–éƒ¨å£°æ˜è¯¥å˜é‡ï¼Œåªéœ€å£°æ˜å®ƒä¸º <code>out</code> ç±»å‹å³å¯ã€‚</li>
</ul>
<p><strong>ç”¨é€”</strong>ï¼š</p>
<ul>
<li><code>out</code> å‚æ•°é€šå¸¸ç”¨äºä»æ–¹æ³•ä¸­è¿”å›å¤šä¸ªå€¼ã€‚åœ¨ C# ä¸­ï¼Œä¸€ä¸ªæ–¹æ³•åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œä½†å¯ä»¥é€šè¿‡ <code>out</code> å‚æ•°è¿”å›é¢å¤–çš„ä¿¡æ¯æˆ–ç»“æœã€‚</li>
<li>åœ¨ä½ çš„ä¾‹å­ä¸­ï¼Œ<code>audioStream</code> æ˜¯ä¸€ä¸ª <code>MemoryStream</code> å¯¹è±¡ï¼Œå¯èƒ½ç”¨äºè¿”å›éŸ³é¢‘æ•°æ®çš„æµã€‚</li>
</ul>
</blockquote>
<p><strong>æ•°æ®æµçš„è½¬æ¢</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">byte</span>[] <span class="title">ReadStreamToByteArray</span>(<span class="params">UnmanagedMemoryStream stream</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> memoryStream = <span class="keyword">new</span> MemoryStream())</span><br><span class="line">    &#123;</span><br><span class="line">        stream.CopyTo(memoryStream);</span><br><span class="line">        <span class="keyword">return</span> memoryStream.ToArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯å°†ä¸€ä¸ª <code>UnmanagedMemoryStream</code> å¯¹è±¡çš„å†…å®¹å¤åˆ¶åˆ°ä¸€ä¸ªæ–°çš„ <code>MemoryStream</code> ä¸­ï¼Œå¹¶è¿”å›å…¶å­—èŠ‚æ•°ç»„ã€‚ä»¥ä¸‹æ˜¯é€æ­¥è§£æï¼š</p>
<ol>
<li><strong><code>using</code> è¯­å¥</strong>ï¼šç¡®ä¿ <code>memoryStream</code> åœ¨ä½¿ç”¨å®Œåè‡ªåŠ¨é‡Šæ”¾èµ„æºï¼Œå³ä½¿åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ä¹Ÿèƒ½ä¿è¯èµ„æºå¾—åˆ°é‡Šæ”¾ã€‚</li>
<li>**<code>stream.CopyTo(memoryStream)</code>**ï¼šå°† <code>UnmanagedMemoryStream</code> çš„å†…å®¹å¤åˆ¶åˆ° <code>memoryStream</code> ä¸­ã€‚<code>CopyTo</code> æ–¹æ³•ä¼šä»æºæµè¯»å–æ•°æ®å¹¶å†™å…¥åˆ°ç›®æ ‡æµã€‚</li>
<li>**<code>memoryStream.ToArray()</code>**ï¼šå°† <code>memoryStream</code> ä¸­çš„å†…å®¹è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„å¹¶è¿”å›ã€‚</li>
</ol>
<blockquote>
<p><code>using</code> è¯­å¥åœ¨ C# ä¸­ç”¨äºç¡®ä¿å¯¹è±¡åœ¨ä½¿ç”¨å®Œåèƒ½å¤Ÿè‡ªåŠ¨é‡Šæ”¾å…¶å ç”¨çš„èµ„æºã€‚ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªä½œç”¨ï¼š</p>
<ol>
<li><strong>è‡ªåŠ¨é‡Šæ”¾èµ„æº</strong>ï¼š<code>using</code> è¯­å¥ä¼šåœ¨ä»£ç å—ç»“æŸæ—¶è‡ªåŠ¨è°ƒç”¨å¯¹è±¡çš„ <code>Dispose</code> æ–¹æ³•ï¼Œé‡Šæ”¾èµ„æºã€‚è¿™åœ¨å¤„ç†éœ€è¦æ˜¾å¼é‡Šæ”¾èµ„æºçš„å¯¹è±¡ï¼ˆå¦‚æ–‡ä»¶æµã€æ•°æ®åº“è¿æ¥ã€å›¾å½¢èµ„æºç­‰ï¼‰æ—¶ç‰¹åˆ«é‡è¦ã€‚</li>
<li><strong>ç®€åŒ–ä»£ç </strong>ï¼šé€šè¿‡ä½¿ç”¨ <code>using</code>ï¼Œä½ ä¸éœ€è¦æ˜¾å¼è°ƒç”¨ <code>Dispose</code>ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä»£ç çš„å¤æ‚æ€§ï¼Œå¹¶æé«˜å¯è¯»æ€§ã€‚</li>
<li><strong>å¼‚å¸¸å®‰å…¨</strong>ï¼šå³ä½¿åœ¨ <code>using</code> è¯­å¥å—ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œ<code>Dispose</code> ä»ç„¶ä¼šè¢«è°ƒç”¨ï¼Œç¡®ä¿èµ„æºå¾—åˆ°æ­£ç¡®é‡Šæ”¾ï¼Œä»è€Œé¿å…å†…å­˜æ³„æ¼ã€‚</li>
</ol>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>using</code> è¯­å¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">csharpå¤åˆ¶ä»£ç using (var fileStream = new FileStream(&quot;example.txt&quot;, FileMode.Open))</span><br><span class="line">&#123;</span><br><span class="line">    // è¿›è¡Œæ–‡ä»¶æ“ä½œ</span><br><span class="line">&#125; // è¿™é‡Œä¼šè‡ªåŠ¨è°ƒç”¨ fileStream.Dispose()</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>fileStream</code> ä¼šåœ¨ <code>using</code> å—ç»“æŸåè‡ªåŠ¨å…³é—­ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ <code>fileStream.Close()</code> æˆ– <code>fileStream.Dispose()</code>ã€‚</p>
<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ul>
<li><code>using</code> è¯­å¥åªèƒ½ç”¨äºå®ç°äº† <code>IDisposable</code> æ¥å£çš„å¯¹è±¡ã€‚</li>
<li>å¦‚æœå¯¹è±¡åœ¨ <code>using</code> å—ä¹‹å¤–çš„åœ°æ–¹ä»ç„¶è¢«å¼•ç”¨ï¼Œç¡®ä¿å¯¹è±¡ä¸ä¼šè¢«é‡å¤é‡Šæ”¾ã€‚</li>
</ul>
</blockquote>
<p>Dcitionary.Keysè¿”å›çš„æ˜¯ï¼Œæ‰€æœ‰keyçš„é›†åˆDictionary2ï¼Œå€¼çš„ç±»å‹å’ŒDictionaryä¸­keyçš„ç±»å‹ä¸€è‡´ã€‚</p>
<h5 id="2-éŸ³é¢‘æ’­æ”¾é€»è¾‘å®ç°"><a href="#2-éŸ³é¢‘æ’­æ”¾é€»è¾‘å®ç°" class="headerlink" title="2.éŸ³é¢‘æ’­æ”¾é€»è¾‘å®ç°"></a>2.éŸ³é¢‘æ’­æ”¾é€»è¾‘å®ç°</h5><p>button_click â†’ handle(åˆ¤æ–­èƒ½å¦æ’­æ”¾) â†’ cleanup(é‡Šæ”¾ä¸Šä¸€æ¬¡æ’­æ”¾çš„å†…å­˜)  â†’ startplay(å¼€å§‹æ’­æ”¾)</p>
<p>éŸ³é¢‘å‚¨å­˜æ–¹å¼å˜åŒ–ï¼šaudiostream                                                                      â†’ wavestream(å¯ä»¥åˆ©ç”¨waveçš„playåŠŸèƒ½)</p>
<p><strong><code>out</code> å…³é”®å­—</strong>ï¼š</p>
<ul>
<li>è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¾“å‡ºå‚æ•°ã€‚åœ¨<u>æ–¹æ³•å†…éƒ¨</u>ï¼Œå¿…é¡»å¯¹å…¶è¿›è¡Œèµ‹å€¼ã€‚</li>
<li>è°ƒç”¨æ–¹æ³•æ—¶ï¼Œ<u>ä¸éœ€è¦åœ¨å¤–éƒ¨å£°æ˜è¯¥å˜é‡</u>ï¼Œåªéœ€å£°æ˜å®ƒä¸º <code>out</code> ç±»å‹å³å¯ã€‚</li>
</ul>
<p><strong>ç”¨é€”</strong>ï¼š</p>
<ul>
<li><code>out</code> å‚æ•°é€šå¸¸ç”¨äºä»æ–¹æ³•ä¸­è¿”å›å¤šä¸ªå€¼ã€‚åœ¨ C# ä¸­ï¼Œä¸€ä¸ªæ–¹æ³•åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œä½†å¯ä»¥é€šè¿‡ <code>out</code> å‚æ•°è¿”å›é¢å¤–çš„ä¿¡æ¯æˆ–ç»“æœã€‚</li>
<li>åœ¨ä¾‹å­ä¸­ï¼Œ<code>audioStream</code> æ˜¯ä¸€ä¸ª <code>MemoryStream</code> å¯¹è±¡ï¼Œå¯èƒ½ç”¨äºè¿”å›éŸ³é¢‘æ•°æ®çš„æµã€‚</li>
</ul>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>TryGetValue</code> æ–¹æ³•å°è¯•ä»æ–‡ä»¶ä¸­è¯»å–éŸ³é¢‘æµï¼Œå¹¶é€šè¿‡ <code>out</code> å‚æ•°è¿”å› <code>MemoryStream</code> å¯¹è±¡ã€‚å¦‚æœæˆåŠŸï¼Œè°ƒç”¨è€…å¯ä»¥ä½¿ç”¨è¿™ä¸ªæµï¼›å¦‚æœå¤±è´¥ï¼Œæµä¼šè¢«è®¾ç½®ä¸º <code>null</code>ã€‚</p>
<blockquote>
<h3 id="WaveFileReader-ä¸-AudioFileReader-çš„åŒºåˆ«"><a href="#WaveFileReader-ä¸-AudioFileReader-çš„åŒºåˆ«" class="headerlink" title="WaveFileReader ä¸ AudioFileReader çš„åŒºåˆ«"></a><code>WaveFileReader</code> ä¸ <code>AudioFileReader</code> çš„åŒºåˆ«</h3><ol>
<li>**<code>WaveFileReader</code>**ï¼š<ul>
<li>ä¸“é—¨ç”¨äºè¯»å– <code>.wav</code> æ–‡ä»¶æ ¼å¼ã€‚</li>
<li>æä¾›å¯¹ WAV æ–‡ä»¶çš„è§£æï¼ŒåŒ…æ‹¬æ–‡ä»¶å¤´ã€é‡‡æ ·ç‡ã€é€šé“æ•°ç­‰ä¿¡æ¯ã€‚</li>
<li>é€‚ç”¨äºéœ€è¦å¤„ç†çº¯ WAV æ•°æ®çš„åœºæ™¯ã€‚</li>
</ul>
</li>
<li>**<code>AudioFileReader</code>**ï¼š<ul>
<li>æ›´é€šç”¨ï¼Œèƒ½å¤Ÿå¤„ç†å¤šç§éŸ³é¢‘æ ¼å¼ï¼ˆå¦‚ WAVã€MP3ã€AAC ç­‰ï¼‰ã€‚</li>
<li>å†…éƒ¨ä¼šæ ¹æ®æ–‡ä»¶æ ¼å¼è‡ªåŠ¨è§£ç å¹¶è½¬æ¢ä¸º PCM æ•°æ®ã€‚</li>
<li>é€‚åˆéœ€è¦å¤„ç†ä¸åŒéŸ³é¢‘æ ¼å¼çš„åœºæ™¯ã€‚</li>
</ul>
</li>
</ol>
<h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><ul>
<li>å¦‚æœä½ åªå¤„ç† WAV æ–‡ä»¶ï¼Œä½¿ç”¨ <code>WaveFileReader</code> å¯ä»¥æ›´é«˜æ•ˆï¼Œå› ä¸ºå®ƒé’ˆå¯¹è¿™ç§æ ¼å¼è¿›è¡Œäº†ä¼˜åŒ–ã€‚</li>
<li>å¦‚æœä½ çš„åº”ç”¨éœ€è¦æ”¯æŒå¤šç§éŸ³é¢‘æ ¼å¼ï¼Œä½¿ç”¨ <code>AudioFileReader</code> ä¼šæ›´æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒå¯ä»¥è‡ªåŠ¨å¤„ç†å¤šç§ç±»å‹çš„éŸ³é¢‘æ•°æ®ã€‚</li>
</ul>
</blockquote>
<h5 id="3-æ’­æ”¾æ–‡ä»¶é€‰æ‹©"><a href="#3-æ’­æ”¾æ–‡ä»¶é€‰æ‹©" class="headerlink" title="3.æ’­æ”¾æ–‡ä»¶é€‰æ‹©"></a>3.æ’­æ”¾æ–‡ä»¶é€‰æ‹©</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ChangeAudioFile</span>(<span class="params">Button button</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®åªå…è®¸é€‰æ‹© .wav æ–‡ä»¶</span></span><br><span class="line">    openFileDialog.Filter = <span class="string">&quot;WAV files (*.wav)|*.wav&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (openFileDialog.ShowDialog() == DialogResult.OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> newFilePath = openFileDialog.FileName;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦ä¸º .wavï¼ˆå¦‚æœéœ€è¦è¿›ä¸€æ­¥éªŒè¯ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (System.IO.Path.GetExtension(newFilePath).ToLower() != <span class="string">&quot;.wav&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            MessageBox.Show(<span class="string">&quot;åªèƒ½é€‰æ‹© .wav æ ¼å¼çš„æ–‡ä»¶ï¼&quot;</span>, <span class="string">&quot;é”™è¯¯&quot;</span>, MessageBoxButtons.OK, MessageBoxIcon.Error);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        button.Text = System.IO.Path.GetFileNameWithoutExtension(newFilePath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ è½½éŸ³é¢‘æ–‡ä»¶ä¸º MemoryStream</span></span><br><span class="line">        <span class="built_in">byte</span>[] audioBytes = System.IO.File.ReadAllBytes(newFilePath);</span><br><span class="line">        System.IO.MemoryStream audioStream = <span class="keyword">new</span> System.IO.MemoryStream(audioBytes);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–° buttonAudioMapping å­—å…¸</span></span><br><span class="line">        <span class="keyword">if</span> (buttonAudioMapping.ContainsKey(button))</span><br><span class="line">        &#123;</span><br><span class="line">            buttonAudioMapping[button].Dispose(); <span class="comment">// é‡Šæ”¾æ—§çš„ MemoryStream</span></span><br><span class="line">            buttonAudioMapping[button] = audioStream;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            buttonAudioMapping.Add(button, audioStream);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–° appSettings ä¸­çš„éŸ³é¢‘æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">        appSettings.ButtonAudioFilePaths[button.Name] = newFilePath;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è‡ªåŠ¨ä¿å­˜è®¾ç½®</span></span><br><span class="line">        settingsManager.SaveSettings(appSettings);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è®¾ç½®æ–‡ä»¶å¯¹è¯æ¡†è¿‡æ»¤å™¨</strong>ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openFileDialog.Filter = <span class="string">&quot;WAV files (*.wav)|*.wav&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>è¿™è¡Œä»£ç è®¾ç½®æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†åªå…è®¸é€‰æ‹© <code>.wav</code> æ–‡ä»¶ã€‚</p>
<p><strong>æ˜¾ç¤ºå¯¹è¯æ¡†å¹¶æ£€æŸ¥ç”¨æˆ·é€‰æ‹©</strong>ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (openFileDialog.ShowDialog() == DialogResult.OK)</span><br></pre></td></tr></table></figure>

<p>æ˜¾ç¤ºæ–‡ä»¶å¯¹è¯æ¡†ï¼Œç”¨æˆ·é€‰æ‹©æ–‡ä»¶åï¼Œå¦‚æœç‚¹å‡»â€œç¡®å®šâ€ï¼Œåˆ™ç»§ç»­æ‰§è¡Œåç»­ä»£ç ã€‚</p>
<p><strong>è·å–é€‰æ‹©çš„æ–‡ä»¶è·¯å¾„</strong>ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> newFilePath = openFileDialog.FileName;</span><br></pre></td></tr></table></figure>

<p><strong>æ£€æŸ¥æ–‡ä»¶æ‰©å±•å</strong>ï¼ˆå¯é€‰ï¼‰ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (System.IO.Path.GetExtension(newFilePath).ToLower() != <span class="string">&quot;.wav&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    MessageBox.Show(<span class="string">&quot;åªèƒ½é€‰æ‹© .wav æ ¼å¼çš„æ–‡ä»¶ï¼&quot;</span>, <span class="string">&quot;é”™è¯¯&quot;</span>, MessageBoxButtons.OK, MessageBoxIcon.Error);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶ä¸æ˜¯ <code>.wav</code> æ ¼å¼ï¼Œåˆ™å¼¹å‡ºé”™è¯¯æç¤ºï¼Œå¹¶é€€å‡ºæ–¹æ³•ã€‚</p>
<p><strong>æ›´æ–°æŒ‰é’®æ–‡æœ¬</strong>ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">button.Text = System.IO.Path.GetFileNameWithoutExtension(newFilePath);</span><br></pre></td></tr></table></figure>

<p>å°†æŒ‰é’®çš„æ–‡æœ¬è®¾ç½®ä¸ºæ–‡ä»¶åï¼Œä¸åŒ…æ‹¬æ‰©å±•åã€‚</p>
<p>**åŠ è½½éŸ³é¢‘æ–‡ä»¶ä¸º <code>MemoryStream</code>**ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">byte</span>[] audioBytes = System.IO.File.ReadAllBytes(newFilePath);</span><br><span class="line">System.IO.MemoryStream audioStream = <span class="keyword">new</span> System.IO.MemoryStream(audioBytes);</span><br></pre></td></tr></table></figure>

<p>è¯»å–é€‰æ‹©çš„éŸ³é¢‘æ–‡ä»¶çš„æ‰€æœ‰å­—èŠ‚ï¼Œå¹¶å°†å…¶å­˜å…¥ä¸€ä¸ª <code>MemoryStream</code> ä¸­ï¼Œä»¥ä¾¿åç»­æ’­æ”¾ã€‚</p>
<p><strong>æ›´æ–° <code>buttonAudioMapping</code> å­—å…¸</strong>ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (buttonAudioMapping.ContainsKey(button))</span><br><span class="line">&#123;</span><br><span class="line">    buttonAudioMapping[button].Dispose(); <span class="comment">// é‡Šæ”¾æ—§çš„ MemoryStream</span></span><br><span class="line">    buttonAudioMapping[button] = audioStream;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    buttonAudioMapping.Add(button, audioStream);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ£€æŸ¥å­—å…¸ä¸­æ˜¯å¦å·²æœ‰è¯¥æŒ‰é’®çš„æ˜ å°„ã€‚å¦‚æœæœ‰ï¼Œå…ˆé‡Šæ”¾æ—§çš„ <code>MemoryStream</code>ï¼Œç„¶åæ›´æ–°ä¸ºæ–°çš„æµï¼›å¦‚æœæ²¡æœ‰ï¼Œç›´æ¥æ·»åŠ æ–°çš„æ˜ å°„ã€‚</p>
<p><strong>æ›´æ–°è®¾ç½®ä¸­çš„éŸ³é¢‘æ–‡ä»¶è·¯å¾„</strong>ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appSettings.ButtonAudioFilePaths[button.Name] = newFilePath;</span><br></pre></td></tr></table></figure>

<p><strong>è‡ªåŠ¨ä¿å­˜è®¾ç½®</strong>ï¼š</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">settingsManager.SaveSettings(appSettings);</span><br></pre></td></tr></table></figure>



<h4 id="éŸ³é‡å¤§å°"><a href="#éŸ³é‡å¤§å°" class="headerlink" title="éŸ³é‡å¤§å°"></a>éŸ³é‡å¤§å°</h4><p>â€¦ç•¥</p>
<h4 id="è¿›åº¦æ¡"><a href="#è¿›åº¦æ¡" class="headerlink" title="è¿›åº¦æ¡"></a>è¿›åº¦æ¡</h4><ol>
<li><code>Timer_Tick</code> æ–¹æ³•</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Timer_Tick</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (waveStream != <span class="literal">null</span> &amp;&amp; !isTrackBarDragging)</span><br><span class="line">    &#123;</span><br><span class="line">        trackBarProgress.Maximum = (<span class="built_in">int</span>)waveStream.TotalTime.TotalSeconds;</span><br><span class="line">        trackBarProgress.Value = (<span class="built_in">int</span>)waveStream.CurrentTime.TotalSeconds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>ä½œç”¨</strong>ï¼šåœ¨å®šæ—¶å™¨çš„æ¯æ¬¡è§¦å‘æ—¶æ›´æ–°è¿›åº¦æ¡çš„æœ€å¤§å€¼å’Œå½“å‰å€¼ã€‚</p>
</li>
<li><p>é€»è¾‘</p>
<p>ï¼š</p>
<ul>
<li>å¦‚æœ <code>waveStream</code> ä¸ä¸º <code>null</code> ä¸”å½“å‰ä¸åœ¨æ‹–åŠ¨è¿›åº¦æ¡ï¼ˆ<code>isTrackBarDragging</code> ä¸º <code>false</code>ï¼‰ï¼Œåˆ™è®¾ç½®è¿›åº¦æ¡çš„æœ€å¤§å€¼ä¸ºéŸ³é¢‘çš„æ€»æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå¹¶å°†å½“å‰å€¼æ›´æ–°ä¸ºéŸ³é¢‘å½“å‰æ’­æ”¾æ—¶é—´ï¼ˆç§’ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<ol start="2">
<li><code>trackBarProgress_MouseDown</code> æ–¹æ³•</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">trackBarProgress_MouseDown</span>(<span class="params"><span class="built_in">object</span> sender, MouseEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    isTrackBarDragging = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ä½œç”¨</strong>ï¼šå½“ç”¨æˆ·å¼€å§‹æ‹–åŠ¨è¿›åº¦æ¡æ—¶è®¾ç½®æ ‡å¿—ã€‚</li>
<li><strong>é€»è¾‘</strong>ï¼šå°† <code>isTrackBarDragging</code> è®¾ç½®ä¸º <code>true</code>ï¼Œè¡¨ç¤ºç”¨æˆ·æ­£åœ¨æ‹–åŠ¨è¿›åº¦æ¡ï¼Œæ­¤æ—¶ä¸åº”æ›´æ–°éŸ³é¢‘çš„æ’­æ”¾ä½ç½®ã€‚</li>
</ul>
<ol start="3">
<li><code>trackBarProgress_MouseUp</code> æ–¹æ³•</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">trackBarProgress_MouseUp</span>(<span class="params"><span class="built_in">object</span> sender, MouseEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    isTrackBarDragging = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (waveStream != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        waveStream.CurrentTime = TimeSpan.FromSeconds(trackBarProgress.Value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>ä½œç”¨</strong>ï¼šå½“ç”¨æˆ·é‡Šæ”¾é¼ æ ‡æ—¶åœæ­¢æ‹–åŠ¨å¹¶æ›´æ–°éŸ³é¢‘æ’­æ”¾ä½ç½®ã€‚</p>
</li>
<li><p>é€»è¾‘</p>
<p>ï¼š</p>
<ul>
<li>å°† <code>isTrackBarDragging</code> è®¾ç½®ä¸º <code>false</code>ï¼Œè¡¨ç¤ºæ‹–åŠ¨ç»“æŸã€‚</li>
<li>å¦‚æœ <code>waveStream</code> ä¸ä¸º <code>null</code>ï¼Œåˆ™æ ¹æ®å½“å‰è¿›åº¦æ¡çš„å€¼æ›´æ–°éŸ³é¢‘çš„å½“å‰æ’­æ”¾æ—¶é—´ã€‚</li>
</ul>
</li>
</ul>
<ol start="4">
<li><code>trackBarProgress_ValueChanged</code> æ–¹æ³•</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">trackBarProgress_ValueChanged</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (waveStream != <span class="literal">null</span> &amp;&amp; !isTrackBarDragging)</span><br><span class="line">    &#123;</span><br><span class="line">        waveStream.CurrentTime = TimeSpan.FromSeconds(trackBarProgress.Value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>ä½œç”¨</strong>ï¼šå½“è¿›åº¦æ¡çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶æ›´æ–°éŸ³é¢‘æ’­æ”¾ä½ç½®ã€‚</p>
</li>
<li><p>é€»è¾‘</p>
<p>ï¼š</p>
<ul>
<li>å¦‚æœ <code>waveStream</code> ä¸ä¸º <code>null</code> ä¸”ä¸åœ¨æ‹–åŠ¨è¿›åº¦æ¡ï¼Œåˆ™æ ¹æ®æ–°çš„è¿›åº¦æ¡å€¼æ›´æ–°éŸ³é¢‘çš„å½“å‰æ’­æ”¾æ—¶é—´ã€‚</li>
</ul>
</li>
</ul>
<h2 id="äºŒã€å¿«æ·é”®"><a href="#äºŒã€å¿«æ·é”®" class="headerlink" title="äºŒã€å¿«æ·é”®"></a>äºŒã€å¿«æ·é”®</h2><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><h5 id="1-å³é”®èœå•"><a href="#1-å³é”®èœå•" class="headerlink" title="1.å³é”®èœå•"></a>1.å³é”®èœå•</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Button_MouseUp</span>(<span class="params"><span class="built_in">object</span> sender, MouseEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (e.Button == MouseButtons.Right)</span><br><span class="line">    &#123;</span><br><span class="line">        Button button = sender <span class="keyword">as</span> Button;</span><br><span class="line">        <span class="keyword">if</span> (button == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        ContextMenuStrip contextMenu = <span class="keyword">new</span> ContextMenuStrip();</span><br><span class="line">        ToolStripMenuItem changeAudioFileMenuItem = <span class="keyword">new</span> ToolStripMenuItem(<span class="string">&quot;æ›´æ”¹éŸ³é¢‘æ–‡ä»¶&quot;</span>);</span><br><span class="line">        ToolStripMenuItem setShortcutKeyMenuItem = <span class="keyword">new</span> ToolStripMenuItem(<span class="string">&quot;è®¾ç½®å¿«æ·é”®&quot;</span>);</span><br><span class="line"></span><br><span class="line">        changeAudioFileMenuItem.Click += (s, <span class="keyword">args</span>) =&gt; ChangeAudioFile(button);</span><br><span class="line">        setShortcutKeyMenuItem.Click += SetShortcutKeyMenuItem_Click;</span><br><span class="line"></span><br><span class="line">        contextMenu.Items.Add(changeAudioFileMenuItem);</span><br><span class="line">        contextMenu.Items.Add(setShortcutKeyMenuItem);</span><br><span class="line">        contextMenu.Show(button, e.Location);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>MouseEventArgs</code> æ˜¯ .NET ä¸­ç”¨äºå¤„ç†é¼ æ ‡äº‹ä»¶çš„æ•°æ®ç±»ï¼Œç»§æ‰¿è‡ª <code>EventArgs</code>ã€‚å®ƒæä¾›äº†å…³äºé¼ æ ‡æ“ä½œçš„ä¿¡æ¯ï¼Œä¾‹å¦‚é¼ æ ‡æŒ‰é’®çš„çŠ¶æ€å’Œé¼ æ ‡æŒ‡é’ˆçš„ä½ç½®ã€‚</p>
<p>ä¸»è¦å±æ€§</p>
<ul>
<li><strong>Button</strong>:<ul>
<li>ç±»å‹: <code>MouseButtons</code></li>
<li>æè¿°: æŒ‡ç¤ºå“ªä¸ªé¼ æ ‡æŒ‰é’®è¢«æŒ‰ä¸‹æˆ–é‡Šæ”¾ï¼ˆå¦‚å·¦é”®ã€å³é”®æˆ–ä¸­é”®ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>Clicks</strong>:<ul>
<li>ç±»å‹: <code>int</code></li>
<li>æè¿°: æŒ‡ç¤ºåœ¨äº‹ä»¶å‘ç”Ÿæ—¶é¼ æ ‡ç‚¹å‡»çš„æ¬¡æ•°ã€‚</li>
</ul>
</li>
<li><strong>X</strong>:<ul>
<li>ç±»å‹: <code>int</code></li>
<li>æè¿°: é¼ æ ‡æŒ‡é’ˆç›¸å¯¹äºæ§ä»¶å·¦ä¸Šè§’çš„ X åæ ‡ã€‚</li>
</ul>
</li>
<li><strong>Y</strong>:<ul>
<li>ç±»å‹: <code>int</code></li>
<li>æè¿°: é¼ æ ‡æŒ‡é’ˆç›¸å¯¹äºæ§ä»¶å·¦ä¸Šè§’çš„ Y åæ ‡ã€‚</li>
</ul>
</li>
</ul>
<h5 id="2-å¿«æ·é”®è®¾ç½®çª—å£çš„å®ç°"><a href="#2-å¿«æ·é”®è®¾ç½®çª—å£çš„å®ç°" class="headerlink" title="2.å¿«æ·é”®è®¾ç½®çª—å£çš„å®ç°"></a>2.å¿«æ·é”®è®¾ç½®çª—å£çš„å®ç°</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetShortcutKeyMenuItem_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ToolStripMenuItem menuItem = sender <span class="keyword">as</span> ToolStripMenuItem;</span><br><span class="line">    <span class="keyword">if</span> (menuItem != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        ContextMenuStrip owner = menuItem.Owner <span class="keyword">as</span> ContextMenuStrip;</span><br><span class="line">        <span class="keyword">if</span> (owner != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Button button = owner.SourceControl <span class="keyword">as</span> Button;</span><br><span class="line">            <span class="keyword">if</span> (button != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">using</span> (<span class="keyword">var</span> shortcutKeyForm = <span class="keyword">new</span> ShortcutKeyForm())</span><br><span class="line">                &#123;</span><br><span class="line">                    isSettingShortcutKey = <span class="literal">true</span>; <span class="comment">// è®¾ç½®çŠ¶æ€ä¸ºæ­£åœ¨è®¾ç½®å¿«æ·é”®</span></span><br><span class="line">                    <span class="keyword">if</span> (shortcutKeyForm.ShowDialog() == DialogResult.OK)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Keys selectedKey = shortcutKeyForm.SelectedKey;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// æ£€æŸ¥å¿«æ·é”®æ˜¯å¦å·²è¢«å…¶ä»–æŒ‰é’®ä½¿ç”¨</span></span><br><span class="line">                        <span class="keyword">if</span> (shortcutKeyMapping.ContainsKey(selectedKey))</span><br><span class="line">                        &#123;</span><br><span class="line">                            MessageBox.Show(<span class="string">&quot;æ­¤å¿«æ·é”®å·²è¢«å…¶ä»–æŒ‰é’®ä½¿ç”¨ï¼Œè¯·é€‰æ‹©å…¶ä»–å¿«æ·é”®ã€‚&quot;</span>);</span><br><span class="line">                            isSettingShortcutKey = <span class="literal">false</span>; <span class="comment">// é‡ç½®çŠ¶æ€</span></span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// å¦‚æœå½“å‰æŒ‰é’®å·²ç»è®¾ç½®äº†å¿«æ·é”®ï¼Œå°†å…¶ä»æ˜ å°„ä¸­ç§»é™¤</span></span><br><span class="line">                        <span class="keyword">var</span> existingKey = shortcutKeyMapping.FirstOrDefault(x =&gt; x.Value == button).Key;</span><br><span class="line">                        <span class="keyword">if</span> (existingKey != Keys.None)</span><br><span class="line">                        &#123;</span><br><span class="line">                            shortcutKeyMapping.Remove(existingKey);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// å°†æ–°çš„å¿«æ·é”®æ˜ å°„åˆ°æŒ‰é’®</span></span><br><span class="line">                        shortcutKeyMapping[selectedKey] = button;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// æ›´æ–°æŒ‰é’®å¯¹åº”çš„ Label æ–‡æœ¬</span></span><br><span class="line">                        <span class="keyword">if</span> (buttonLabelMapping.TryGetValue(button, <span class="keyword">out</span> Label label))</span><br><span class="line">                        &#123;</span><br><span class="line">                            label.Text = <span class="string">$&quot;å¿«æ·é”®: <span class="subst">&#123;selectedKey&#125;</span>&quot;</span>;</span><br><span class="line">                            label.Visible = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    isSettingShortcutKey = <span class="literal">false</span>; <span class="comment">// é‡ç½®çŠ¶æ€</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">ShortcutKeyForm</span> : <span class="title">Form</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Keys SelectedKey &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShortcutKeyForm</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        InitializeComponent();</span><br><span class="line">        <span class="keyword">this</span>.KeyPreview = <span class="literal">true</span>; <span class="comment">// ä½¿ Form å¯ä»¥æ¥æ”¶æŒ‰é”®äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">this</span>.Text = <span class="string">&quot;å¿«æ·é”®ç»‘å®š&quot;</span>; <span class="comment">// è®¾ç½®çª—å£æ ‡é¢˜</span></span><br><span class="line">        <span class="comment">// è®¾ç½®çª—å£å¯åŠ¨ä½ç½®ä¸ºå±å¹•ä¸­å¿ƒ</span></span><br><span class="line">        <span class="keyword">this</span>.StartPosition = FormStartPosition.CenterScreen;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ShortcutKeyForm_KeyDown</span>(<span class="params"><span class="built_in">object</span> sender, KeyEventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥æ˜¯å¦æ˜¯ &lt;space&gt; é”®</span></span><br><span class="line">        <span class="keyword">if</span> (e.KeyCode == Keys.Space)</span><br><span class="line">        &#123;</span><br><span class="line">            MessageBox.Show(<span class="string">&quot;ä¸èƒ½å°† &lt;space&gt; é”®è®¾ç½®ä¸ºå¿«æ·é”®ã€‚&quot;</span>);</span><br><span class="line">            e.SuppressKeyPress = <span class="literal">true</span>; <span class="comment">// é˜²æ­¢é»˜è®¤è¡Œä¸º</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        SelectedKey = e.KeyCode;</span><br><span class="line">        lblInstruction.Text = <span class="string">$&quot;æŒ‰ä¸‹çš„é”®: <span class="subst">&#123;SelectedKey&#125;</span>&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">btnConfirm_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.DialogResult = DialogResult.OK;</span><br><span class="line">        <span class="keyword">this</span>.Close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-å¿«æ·é”®è®¾ç½®çš„å“åº”"><a href="#3-å¿«æ·é”®è®¾ç½®çš„å“åº”" class="headerlink" title="3.å¿«æ·é”®è®¾ç½®çš„å“åº”"></a>3.å¿«æ·é”®è®¾ç½®çš„å“åº”</h5><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">ProcessCmdKey</span>(<span class="params"><span class="keyword">ref</span> Message msg, Keys keyData</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ­£åœ¨è®¾ç½®å¿«æ·é”®ï¼Œå¹¶ä¸”å°è¯•è®¾ç½® &lt;space&gt; é”®</span></span><br><span class="line">    <span class="keyword">if</span> (isSettingShortcutKey)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å–æ¶ˆå¿«æ·é”®è®¾ç½®çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">if</span> (keyData == Keys.Space)</span><br><span class="line">        &#123;</span><br><span class="line">            MessageBox.Show(<span class="string">&quot;ä¸èƒ½å°† &lt;space&gt; é”®è®¾ç½®ä¸ºå¿«æ·é”®ã€‚&quot;</span>);</span><br><span class="line">            isSettingShortcutKey = <span class="literal">false</span>; <span class="comment">// å–æ¶ˆè®¾ç½®çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// è¡¨ç¤ºäº‹ä»¶å·²å¤„ç†</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®å…¶ä»–å¿«æ·é”®</span></span><br><span class="line">        shortcutKey = keyData;</span><br><span class="line">        MessageBox.Show(<span class="string">$&quot;å¿«æ·é”®å·²è®¾ç½®ä¸º: <span class="subst">&#123;shortcutKey&#125;</span>&quot;</span>);</span><br><span class="line">        isSettingShortcutKey = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥å¿«æ·é”®æ˜¯å¦å·²è¢«ä½¿ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (shortcutKeyMapping.ContainsKey(shortcutKey))</span><br><span class="line">        &#123;</span><br><span class="line">            MessageBox.Show(<span class="string">&quot;æ­¤å¿«æ·é”®å·²è¢«å…¶ä»–æŒ‰é’®ä½¿ç”¨ï¼Œè¯·é€‰æ‹©å…¶ä»–å¿«æ·é”®ã€‚&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†å¿«æ·é”®æ˜ å°„åˆ°æŒ‰é’®ä¸Š</span></span><br><span class="line">        <span class="keyword">if</span> (buttonLabelMapping.TryGetValue(ButtonPlay, <span class="keyword">out</span> Label label))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// ç§»é™¤æ—§çš„å¿«æ·é”®</span></span><br><span class="line">            <span class="keyword">if</span> (shortcutKeyMapping.ContainsKey(shortcutKey))</span><br><span class="line">            &#123;</span><br><span class="line">                shortcutKeyMapping.Remove(shortcutKey);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            label.Text = <span class="string">$&quot;å¿«æ·é”®: <span class="subst">&#123;shortcutKey&#125;</span>&quot;</span>;</span><br><span class="line">            label.Visible = <span class="literal">true</span>;</span><br><span class="line">            shortcutKeyMapping[shortcutKey] = ButtonPlay; <span class="comment">// ä¸º ButtonPlay è®¾ç½®å¿«æ·é”®æ˜ å°„</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// è¡¨ç¤ºäº‹ä»¶å·²å¤„ç†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç† &lt;space&gt; é”®ï¼Œè°ƒç”¨ ButtonPlay_Click</span></span><br><span class="line">    <span class="keyword">if</span> (keyData == Keys.Space)</span><br><span class="line">    &#123;</span><br><span class="line">        ButtonPlay_Click(ButtonPlay, EventArgs.Empty);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// è¡¨ç¤ºäº‹ä»¶å·²å¤„ç†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ˜¯å¦å¯ç”¨äº†å¿«æ·é”®åŠŸèƒ½</span></span><br><span class="line">    <span class="keyword">if</span> (isShortcutKeyEnabled &amp;&amp; shortcutKeyMapping.TryGetValue(keyData, <span class="keyword">out</span> Button button))</span><br><span class="line">    &#123;</span><br><span class="line">        Button_Click(button); <span class="comment">// è§¦å‘ä¸å¿«æ·é”®å…³è”çš„æŒ‰é’®ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// è¡¨ç¤ºäº‹ä»¶å·²å¤„ç†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é»˜è®¤å¤„ç†å…¶ä»–é”®</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">base</span>.ProcessCmdKey(<span class="keyword">ref</span> msg, keyData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="å…¨å±€å“åº”"><a href="#å…¨å±€å“åº”" class="headerlink" title="å…¨å±€å“åº”"></a>å…¨å±€å“åº”</h4><p>å…·ä½“æ¥è¯´ï¼Œä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯ç›‘æ§æŒ‰é”®æŒ‰ä¸‹äº‹ä»¶ï¼Œå¹¶åœ¨ç‰¹å®šçš„å¿«æ·é”®è¢«æŒ‰ä¸‹æ—¶è§¦å‘ç›¸åº”æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ã€‚</p>
<ol>
<li>å¸¸é‡å’Œå§”æ‰˜å®šä¹‰</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">int</span> WH_KEYBOARD_LL = <span class="number">13</span>; <span class="comment">// é’©å­ç±»å‹</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">int</span> WM_KEYDOWN = <span class="number">0x0100</span>; <span class="comment">// æŒ‰é”®æŒ‰ä¸‹æ¶ˆæ¯</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">delegate</span> IntPtr <span class="title">LowLevelKeyboardProc</span>(<span class="params"><span class="built_in">int</span> nCode, IntPtr wParam, IntPtr lParam</span>)</span>;</span><br><span class="line"><span class="keyword">private</span> LowLevelKeyboardProc _proc;</span><br><span class="line"><span class="keyword">private</span> IntPtr _hookID = IntPtr.Zero;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>WH_KEYBOARD_LL</code></strong>: å®šä¹‰äº†ä½çº§é”®ç›˜é’©å­çš„ç±»å‹ã€‚</li>
<li><strong><code>WM_KEYDOWN</code></strong>: å®šä¹‰äº†é”®æŒ‰ä¸‹çš„æ¶ˆæ¯ã€‚</li>
<li><strong><code>LowLevelKeyboardProc</code></strong>: å®šä¹‰äº†ä¸€ä¸ªå§”æ‰˜ï¼Œç”¨äºå¤„ç†é”®ç›˜äº‹ä»¶çš„å›è°ƒæ–¹æ³•ã€‚</li>
<li><strong><code>_proc</code> å’Œ <code>_hookID</code></strong>: å­˜å‚¨é’©å­å›è°ƒå‡½æ•°å’Œé’©å­ IDã€‚</li>
</ul>
<ol start="2">
<li>è®¾ç½®é’©å­</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetHook</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    _proc = HookCallback;</span><br><span class="line">    _hookID = SetWindowsHookEx(WH_KEYBOARD_LL, _proc, IntPtr.Zero, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>SetHook</code></strong>: ç”¨äºè®¾ç½®å…¨å±€é”®ç›˜é’©å­ã€‚</li>
<li><strong><code>SetWindowsHookEx</code></strong>: è°ƒç”¨ Windows API è®¾ç½®é’©å­ï¼Œä¼ å…¥é’©å­ç±»å‹ã€å›è°ƒæ–¹æ³•å’Œå…¶ä»–å‚æ•°ã€‚</li>
</ul>
<ol start="3">
<li>é’©å­å›è°ƒ</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> IntPtr <span class="title">HookCallback</span>(<span class="params"><span class="built_in">int</span> nCode, IntPtr wParam, IntPtr lParam</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (nCode &gt;= <span class="number">0</span> &amp;&amp; wParam == (IntPtr)WM_KEYDOWN)</span><br><span class="line">    &#123;</span><br><span class="line">        Keys key = (Keys)Marshal.ReadInt32(lParam);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥å¿«æ·é”®æ˜ å°„å­—å…¸</span></span><br><span class="line">        <span class="keyword">if</span> (shortcutKeyMapping.TryGetValue(key, <span class="keyword">out</span> Button button))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// è§¦å‘ä¸å¿«æ·é”®å…³è”çš„æŒ‰é’®ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">            Button_Click(button); <span class="comment">// æ›¿æ¢ä¸ºä½ çš„åŠŸèƒ½è°ƒç”¨</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> CallNextHookEx(_hookID, nCode, wParam, lParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong><code>HookCallback</code></strong>: é’©å­å›è°ƒæ–¹æ³•ï¼Œåœ¨æ¯æ¬¡æŒ‰é”®äº‹ä»¶è§¦å‘æ—¶è¢«è°ƒç”¨ã€‚</p>
</li>
<li><p>é€»è¾‘</p>
<p>ï¼š</p>
<ul>
<li>æ£€æŸ¥ <code>nCode</code> æ˜¯å¦å¤§äºç­‰äº 0ï¼ˆè¡¨ç¤ºæœ‰æ•ˆçš„äº‹ä»¶ï¼‰ã€‚</li>
<li>æ£€æŸ¥ <code>wParam</code> æ˜¯å¦ä¸º <code>WM_KEYDOWN</code>ï¼ˆè¡¨ç¤ºæŒ‰é”®æŒ‰ä¸‹äº‹ä»¶ï¼‰ã€‚</li>
<li>ä½¿ç”¨ <code>Marshal.ReadInt32</code> ä» <code>lParam</code> ä¸­è¯»å–æŒ‰é”®å€¼ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦åœ¨ <code>shortcutKeyMapping</code> å­—å…¸ä¸­å­˜åœ¨è¯¥é”®ã€‚</li>
<li>å¦‚æœå­˜åœ¨ï¼Œåˆ™è§¦å‘å¯¹åº”æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ã€‚</li>
</ul>
</li>
</ul>
<ol start="4">
<li>å¸è½½é’©å­</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UnhookWindowsHookEx</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    UnhookWindowsHookEx(_hookID);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>UnhookWindowsHookEx</code></strong>: å¸è½½å…¨å±€é”®ç›˜é’©å­ï¼Œé‡Šæ”¾èµ„æºã€‚</li>
</ul>
<ol start="5">
<li>DLL å¯¼å…¥</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">csharpå¤åˆ¶ä»£ç [DllImport(&quot;user32.dll&quot;)]</span><br><span class="line">private static extern IntPtr SetWindowsHookEx(int idHook, LowLevelKeyboardProc lpfn, IntPtr hMod, uint dwThreadId);</span><br><span class="line"></span><br><span class="line">[DllImport(&quot;user32.dll&quot;)]</span><br><span class="line">[return: MarshalAs(UnmanagedType.Bool)]</span><br><span class="line">private static extern bool UnhookWindowsHookEx(IntPtr hhk);</span><br><span class="line"></span><br><span class="line">[DllImport(&quot;user32.dll&quot;)]</span><br><span class="line">private static extern IntPtr CallNextHookEx(IntPtr hhk, int nCode, IntPtr wParam, IntPtr lParam);</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™äº› <code>DllImport</code> å±æ€§å¯¼å…¥ Windows API å‡½æ•°ï¼Œå…è®¸ C# ä»£ç è°ƒç”¨ä½çº§åˆ«çš„é’©å­åŠŸèƒ½ã€‚</li>
</ul>
<ol start="6">
<li>çª—ä½“äº‹ä»¶</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnLoad</span>(<span class="params">EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">base</span>.OnLoad(e);</span><br><span class="line">    SetHook();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnFormClosing</span>(<span class="params">FormClosingEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    UnhookWindowsHookEx();</span><br><span class="line">    <span class="keyword">base</span>.OnFormClosing(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>OnLoad</code></strong>: åœ¨çª—ä½“åŠ è½½æ—¶è®¾ç½®é’©å­ã€‚</li>
<li><strong><code>OnFormClosing</code></strong>: åœ¨çª—ä½“å…³é—­æ—¶å¸è½½é’©å­ï¼Œé˜²æ­¢èµ„æºæ³„éœ²ã€‚</li>
</ul>
<h2 id="ä¸‰ã€æ“ä½œå­˜å‚¨"><a href="#ä¸‰ã€æ“ä½œå­˜å‚¨" class="headerlink" title="ä¸‰ã€æ“ä½œå­˜å‚¨"></a>ä¸‰ã€æ“ä½œå­˜å‚¨</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ApplySettings</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®å¿«æ·é”®</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> kvp <span class="keyword">in</span> appSettings.ShortcutKeys)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> buttonName = kvp.Key;</span><br><span class="line">        <span class="keyword">var</span> key = kvp.Value;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾ä¸æŒ‰é’®åç§°å¯¹åº”çš„æŒ‰é’®æ§ä»¶</span></span><br><span class="line">        <span class="keyword">var</span> button = <span class="keyword">this</span>.Controls.Find(buttonName, <span class="literal">true</span>).FirstOrDefault() <span class="keyword">as</span> Button;</span><br><span class="line">        <span class="keyword">if</span> (button != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (shortcutKeyMapping.ContainsKey(key))</span><br><span class="line">            &#123;</span><br><span class="line">                shortcutKeyMapping.Remove(key); <span class="comment">// ç§»é™¤æ—§çš„é”®æ˜ å°„</span></span><br><span class="line">            &#125;</span><br><span class="line">            shortcutKeyMapping[key] = button;</span><br><span class="line">            <span class="keyword">if</span> (buttonLabelMapping.TryGetValue(button, <span class="keyword">out</span> Label label))</span><br><span class="line">            &#123;</span><br><span class="line">                label.Text = <span class="string">$&quot;å¿«æ·é”®: <span class="subst">&#123;key&#125;</span>&quot;</span>;</span><br><span class="line">                label.Visible = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®éŸ³é‡</span></span><br><span class="line">    volumeSlider.Volume = appSettings.Volume;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ è½½æŒ‰é’®å’ŒéŸ³é¢‘æ–‡ä»¶è·¯å¾„æ˜ å°„</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> kvp <span class="keyword">in</span> appSettings.ButtonAudioFilePaths)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> buttonName = kvp.Key;</span><br><span class="line">        <span class="keyword">var</span> filePath = kvp.Value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> button = <span class="keyword">this</span>.Controls.Find(buttonName, <span class="literal">true</span>).FirstOrDefault() <span class="keyword">as</span> Button;</span><br><span class="line">        <span class="keyword">if</span> (button != <span class="literal">null</span> &amp;&amp; File.Exists(filePath))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">byte</span>[] audioBytes = File.ReadAllBytes(filePath);</span><br><span class="line">            MemoryStream audioStream = <span class="keyword">new</span> MemoryStream(audioBytes);</span><br><span class="line">            buttonAudioMapping[button] = audioStream;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ›´æ–°æŒ‰é’®æ–‡æœ¬ä¸ºæ–‡ä»¶åï¼ˆä¸åŒ…æ‹¬æ‰©å±•åï¼‰</span></span><br><span class="line">            button.Text = Path.GetFileNameWithoutExtension(filePath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Form1_FormClosing</span>(<span class="params"><span class="built_in">object</span> sender, FormClosingEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜éŸ³é‡</span></span><br><span class="line">    appSettings.Volume = volumeSlider.Volume;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿å­˜å¿«æ·é”®è®¾ç½®</span></span><br><span class="line">    appSettings.ShortcutKeys.Clear();</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> kvp <span class="keyword">in</span> shortcutKeyMapping)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> key = kvp.Key;</span><br><span class="line">        <span class="keyword">var</span> button = kvp.Value;</span><br><span class="line">        appSettings.ShortcutKeys[button.Name] = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿å­˜æŒ‰é’®å’ŒéŸ³é¢‘æ–‡ä»¶è·¯å¾„æ˜ å°„</span></span><br><span class="line">    SaveButtonAudioPaths();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ›´æ–° LastLoginTime</span></span><br><span class="line">    appSettings.LastLoginTime = DateTime.Now;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿å­˜è®¾ç½®</span></span><br><span class="line">    settingsManager.SaveSettings(appSettings);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SaveButtonAudioPaths</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> kvp <span class="keyword">in</span> buttonAudioMapping)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> button = kvp.Key;</span><br><span class="line">        <span class="keyword">if</span> (appSettings.ButtonAudioFilePaths.TryGetValue(button.Name, <span class="keyword">out</span> <span class="keyword">var</span> existingFilePath))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœå·²ç»æœ‰æ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œä½¿ç”¨ç°æœ‰è·¯å¾„</span></span><br><span class="line">            appSettings.ButtonAudioFilePaths[button.Name] = existingFilePath;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ShowLoginForm</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    DateTime lastLoginTime = DateTime.MinValue; <span class="comment">// åˆå§‹åŒ–å˜é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä» SettingsManager åŠ è½½è®¾ç½®</span></span><br><span class="line">    AppSettings settings = settingsManager.LoadSettings();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥ LastLoginTime æ˜¯å¦å­˜åœ¨å’Œéç©º</span></span><br><span class="line">    <span class="keyword">if</span> (settings.LastLoginTime.HasValue &amp;&amp; DateTime.Now - settings.LastLoginTime.Value &lt; TimeSpan.FromDays(<span class="number">1</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>; <span class="comment">// å¦‚æœä¸Šæ¬¡ç™»å½•æ—¶é—´åœ¨ä¸€å¤©å†…ï¼Œåˆ™ä¸æ˜¾ç¤ºç™»å½•çª—å£</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»º LoginForm å®ä¾‹å¹¶ä¼ é€’ SettingsManager</span></span><br><span class="line">    LoginForm loginForm = <span class="keyword">new</span> LoginForm(settingsManager);</span><br><span class="line">    <span class="keyword">if</span> (loginForm.ShowDialog() != DialogResult.OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœç™»å½•ä¸æˆåŠŸï¼Œå…³é—­ä¸»çª—å£</span></span><br><span class="line">        <span class="keyword">this</span>.Close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-ApplySettings-æ–¹æ³•"><a href="#1-ApplySettings-æ–¹æ³•" class="headerlink" title="1. ApplySettings æ–¹æ³•"></a>1. <code>ApplySettings</code> æ–¹æ³•</h3><p>è¯¥æ–¹æ³•ç”¨äºåº”ç”¨ä¹‹å‰ä¿å­˜çš„è®¾ç½®ï¼ŒåŒ…æ‹¬å¿«æ·é”®ã€éŸ³é‡å’ŒæŒ‰é’®ä¸éŸ³é¢‘æ–‡ä»¶è·¯å¾„çš„æ˜ å°„ã€‚</p>
<ul>
<li><strong>å¿«æ·é”®è®¾ç½®</strong>ï¼š<ul>
<li>éå† <code>appSettings.ShortcutKeys</code> å­—å…¸ï¼ŒæŸ¥æ‰¾ä¸æŒ‰é’®åç§°å¯¹åº”çš„æŒ‰é’®æ§ä»¶ã€‚</li>
<li>å¦‚æœæŒ‰é’®å­˜åœ¨ï¼Œç§»é™¤æ—§çš„é”®æ˜ å°„ï¼Œå¹¶å°†æ–°æ˜ å°„æ·»åŠ åˆ° <code>shortcutKeyMapping</code> ä¸­ã€‚</li>
<li>æ›´æ–°æŒ‰é’®å¯¹åº”çš„æ ‡ç­¾ï¼Œæ˜¾ç¤ºå½“å‰å¿«æ·é”®ã€‚</li>
</ul>
</li>
<li><strong>éŸ³é‡è®¾ç½®</strong>ï¼š<ul>
<li>å°†éŸ³é‡æ»‘å—çš„å€¼è®¾ç½®ä¸ºä¿å­˜çš„éŸ³é‡ã€‚</li>
</ul>
</li>
<li><strong>éŸ³é¢‘æ–‡ä»¶è·¯å¾„åŠ è½½</strong>ï¼š<ul>
<li>éå† <code>appSettings.ButtonAudioFilePaths</code> å­—å…¸ï¼ŒæŸ¥æ‰¾ä¸æŒ‰é’®åç§°å¯¹åº”çš„éŸ³é¢‘æ–‡ä»¶è·¯å¾„ã€‚</li>
<li>å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¯»å–éŸ³é¢‘æ–‡ä»¶ï¼Œå­˜å…¥ <code>buttonAudioMapping</code> å­—å…¸ä¸­ï¼Œå¹¶æ›´æ–°æŒ‰é’®æ–‡æœ¬ä¸ºæ–‡ä»¶åï¼ˆä¸åŒ…æ‹¬æ‰©å±•åï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h3 id="2-Form1-FormClosing-æ–¹æ³•"><a href="#2-Form1-FormClosing-æ–¹æ³•" class="headerlink" title="2. Form1_FormClosing æ–¹æ³•"></a>2. <code>Form1_FormClosing</code> æ–¹æ³•</h3><p>è¯¥æ–¹æ³•åœ¨çª—ä½“å…³é—­æ—¶è°ƒç”¨ï¼Œç”¨äºä¿å­˜ç”¨æˆ·è®¾ç½®ã€‚</p>
<ul>
<li><strong>ä¿å­˜éŸ³é‡</strong>ï¼šå°†å½“å‰éŸ³é‡æ»‘å—çš„å€¼ä¿å­˜åˆ° <code>appSettings.Volume</code>ã€‚</li>
<li><strong>ä¿å­˜å¿«æ·é”®è®¾ç½®</strong>ï¼šæ¸…ç©ºæ—§çš„å¿«æ·é”®è®¾ç½®ï¼Œå¹¶éå† <code>shortcutKeyMapping</code>ï¼Œä¿å­˜æ–°çš„å¿«æ·é”®åˆ° <code>appSettings.ShortcutKeys</code>ã€‚</li>
<li><strong>ä¿å­˜æŒ‰é’®ä¸éŸ³é¢‘æ–‡ä»¶è·¯å¾„æ˜ å°„</strong>ï¼šè°ƒç”¨ <code>SaveButtonAudioPaths</code> æ–¹æ³•æ¥ä¿å­˜éŸ³é¢‘æ–‡ä»¶è·¯å¾„çš„æ˜ å°„ã€‚</li>
<li><strong>æ›´æ–°æœ€åç™»å½•æ—¶é—´</strong>ï¼šå°†å½“å‰æ—¶é—´è®¾ç½®ä¸º <code>appSettings.LastLoginTime</code>ã€‚</li>
<li><strong>ä¿å­˜è®¾ç½®</strong>ï¼šè°ƒç”¨ <code>settingsManager.SaveSettings(appSettings)</code> å°†æ‰€æœ‰è®¾ç½®ä¿å­˜åˆ°æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­ã€‚</li>
</ul>
<h3 id="3-SaveButtonAudioPaths-æ–¹æ³•"><a href="#3-SaveButtonAudioPaths-æ–¹æ³•" class="headerlink" title="3. SaveButtonAudioPaths æ–¹æ³•"></a>3. <code>SaveButtonAudioPaths</code> æ–¹æ³•</h3><p>è¿™ä¸ªæ–¹æ³•ç”¨äºä¿å­˜æŒ‰é’®ä¸éŸ³é¢‘æ–‡ä»¶è·¯å¾„çš„æ˜ å°„ã€‚</p>
<ul>
<li>éå† <code>buttonAudioMapping</code>ï¼Œå¯¹äºæ¯ä¸ªæŒ‰é’®ï¼Œæ£€æŸ¥ <code>appSettings.ButtonAudioFilePaths</code> ä¸­æ˜¯å¦å·²ç»æœ‰å¯¹åº”çš„æ–‡ä»¶è·¯å¾„ã€‚å¦‚æœæœ‰ï¼Œåˆ™ä¿ç•™ç°æœ‰è·¯å¾„ï¼ˆé€»è¾‘å¯èƒ½éœ€è¦è¡¥å……å…·ä½“è·¯å¾„æ›´æ–°çš„éƒ¨åˆ†ï¼‰ã€‚</li>
</ul>
<h3 id="4-ShowLoginForm-æ–¹æ³•"><a href="#4-ShowLoginForm-æ–¹æ³•" class="headerlink" title="4. ShowLoginForm æ–¹æ³•"></a>4. <code>ShowLoginForm</code> æ–¹æ³•</h3><p>è¯¥æ–¹æ³•ç”¨äºå¤„ç†ç”¨æˆ·ç™»å½•é€»è¾‘ã€‚</p>
<ul>
<li><strong>æœ€åç™»å½•æ—¶é—´æ£€æŸ¥</strong>ï¼šä» <code>settingsManager</code> ä¸­åŠ è½½è®¾ç½®ï¼Œæ£€æŸ¥ <code>LastLoginTime</code> æ˜¯å¦å­˜åœ¨ä¸”åœ¨ä¸€å¤©å†…ã€‚å¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œä¸æ˜¾ç¤ºç™»å½•çª—å£ã€‚</li>
<li><strong>æ˜¾ç¤ºç™»å½•çª—å£</strong>ï¼šå¦‚æœéœ€è¦ç™»å½•ï¼Œåˆ›å»º <code>LoginForm</code> çš„å®ä¾‹å¹¶ä¼ é€’ <code>settingsManager</code>ï¼Œæ˜¾ç¤ºç™»å½•å¯¹è¯æ¡†ã€‚å¦‚æœç”¨æˆ·æœªæˆåŠŸç™»å½•ï¼Œåˆ™å…³é—­ä¸»çª—å£ã€‚</li>
</ul>
<h2 id="å››ã€è½¯ä»¶çš„å°è£…"><a href="#å››ã€è½¯ä»¶çš„å°è£…" class="headerlink" title="å››ã€è½¯ä»¶çš„å°è£…"></a>å››ã€è½¯ä»¶çš„å°è£…</h2><p>ç•¥â€¦</p>
</div>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2025-04-13</span>
            
            
             
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                
                    <span>ä¸Šä¸€ç¯‡ï¼š<a href='/2025/04/13/%E7%9B%B4%E6%92%AD%E9%9F%B3%E9%A2%91%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/'>ç›´æ’­éŸ³é¢‘å…ƒç´ çš„æ¸¸æˆåŒ–å½±è§†åŒ–</a></span>
                

                
                    <span class="post-footer-pre-next-last-span-right">ä¸‹ä¸€ç¯‡ï¼š<a href="/2025/04/13/%E5%A3%B0%E5%AD%A6%E5%8E%9F%E7%90%86%E5%92%8C%E9%9F%B3%E9%A2%91%E7%A1%AC%E4%BB%B6%E5%8E%9F%E7%90%86/">å£°å­¦åŸç†å’ŒéŸ³é¢‘ç¡¬ä»¶åŸç†</a>
                    </span>
                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 2002-2025 Carol 

            
                

            
        </span>
       
    
</div>



<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ğŸŒŠçœ‹è¿‡å¤§æµ·çš„äººä¸ä¼šå¿˜è®°æµ·çš„å¹¿é˜”ğŸŒŠ</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery/lightgallery.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // å¯ç”¨æ’ä»¶
            thumbnail: true,          // æ˜¾ç¤ºç¼©ç•¥å›¾
            zoom: true,               // å¯ç”¨ç¼©æ”¾åŠŸ
            rotate: true,             // å¯ç”¨æ—‹è½¬åŠŸèƒ½èƒ½
            autoplay: true,        // å¯ç”¨è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
            fullScreen: true,      // å¯ç”¨å…¨å±åŠŸèƒ½
            pager: false, //é¡µç ,
            zoomFromOrigin: true,   // ä»åŸå§‹ä½ç½®ç¼©æ”¾
            actualSize: true,       // å¯ç”¨æŸ¥çœ‹å®é™…å¤§å°çš„åŠŸèƒ½
            enableZoomAfter: 300,    // å»¶è¿Ÿç¼©æ”¾ï¼Œç¡®ä¿å›¾ç‰‡åŠ è½½å®Œæˆåå¯ç¼©æ”¾
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // ä¿®å¤é€‰æ‹©å™¨
    }
    
</script>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>